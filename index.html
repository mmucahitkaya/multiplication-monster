<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>Multiplication Monster</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');
        
        :root {
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * {
            box-sizing: border-box;
            /* Dokunmatik gecikmesini √∂nler */
            touch-action: manipulation; 
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f9ff;
            overflow: hidden;
            user-select: none;
            /* Dynamic Viewport Height: Adres √ßubuƒüu sorununu √ß√∂zer */
            height: 100dvh; 
            width: 100vw;
            margin: 0;
            padding: 0;
        }

        /* Ana Ta≈üƒ±yƒ±cƒ±: T√ºm ekranƒ± kaplar ve esnek kutu modelini kullanƒ±r */
        .app-layout {
            height: 100%;
            width: 100%;
            max-width: 600px; /* Tabletlerde √ßok geni≈ülememesi i√ßin */
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            /* Safe area bo≈üluklarƒ± */
            padding-top: calc(var(--safe-top) + 10px);
            padding-bottom: calc(var(--safe-bottom) + 10px);
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* 1. √úST KISIM (Skorlar) - K√º√ß√ºlmez */
        .header-section {
            flex-shrink: 0; 
            margin-bottom: 0.5rem;
            /* Dil butonu ile √ßakƒ±≈ümamasƒ± i√ßin saƒüa bo≈üluk */
            padding-right: 60px; 
        }

        /* 2. ORTA KISIM (Soru Kutusu) - Esner */
        .question-section {
            flex-grow: 1; /* Kalan t√ºm bo≈üluƒüu bu doldurur */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 3px solid #3b82f6;
            margin-bottom: 1rem;
            position: relative;
            min-height: 180px; /* √áok k√º√ß√ºl√ºp ezilmesini engeller */
        }

        /* 3. ALT KISIM (Tu≈ülar) - K√º√ß√ºlmez ama esnek */
        .numpad-section {
            flex-shrink: 0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            /* Ekran y√ºksekliƒüine g√∂re tu≈ü y√ºksekliƒüini ayarla */
            height: 40%; 
            max-height: 350px;
            min-height: 200px;
        }

        .numpad-btn {
            background-color: white;
            border-bottom: 4px solid #e2e8f0;
            border-radius: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: #4b5563;
            transition: transform 0.1s;
            cursor: pointer;
            height: 100%; /* Grid h√ºcresini doldur */
        }

        .numpad-btn:active {
            transform: translateY(2px);
            border-bottom: 2px solid #e2e8f0;
        }

        /* EKRAN KISAYSA (iPhone SE, Yatay mod vb) √ñZEL AYARLAR */
        @media (max-height: 700px) {
            .numpad-section {
                height: 45%; /* Tu≈ülara biraz daha yer ver */
                gap: 0.3rem;
            }
            .header-section {
                margin-bottom: 0.2rem;
            }
            .question-section {
                margin-bottom: 0.5rem;
                min-height: 140px;
            }
            .numpad-btn {
                font-size: 1.5rem;
                border-bottom-width: 3px;
                border-radius: 0.6rem;
            }
            /* Skor fontlarƒ±nƒ± k√º√ß√ºlt */
            .score-text { font-size: 1rem !important; }
            .score-val { font-size: 1.2rem !important; }
            
            /* Soru fontlarƒ±nƒ± k√º√ß√ºlt */
            .q-text { font-size: 3.5rem !important; }
            .ans-box { height: 3.5rem !important; min-width: 80px !important; font-size: 2.5rem !important; }
        }

        /* Dil Se√ßimi */
        .lang-container {
            position: fixed;
            top: calc(var(--safe-top) + 10px);
            right: 1rem;
            z-index: 50;
            display: flex;
            gap: 0.5rem;
        }
        .lang-btn {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: none;
        }
        .lang-btn.active {
            background: white;
            transform: scale(1.1);
            opacity: 1;
            filter: grayscale(0);
        }
        .lang-btn:not(.active) {
            opacity: 0.6;
            filter: grayscale(1);
        }

        /* Emoji Se√ßici */
        .emoji-grid {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            max-height: 150px;
            overflow-y: auto;
        }
        .emoji-option {
            font-size: 2rem;
            padding: 0.2rem;
            border-radius: 0.5rem;
            border: 2px solid transparent;
        }
        .emoji-option.selected {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }

        /* Animasyonlar */
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            100% { transform: translateY(-300px) scale(1.2); opacity: 0; }
        }
        .emoji-animated {
            position: fixed;
            pointer-events: none;
            z-index: 100;
            font-size: 3rem;
            animation: floatUp 1.5s ease-out forwards;
        }
        .shake {
            animation: shake 0.4s ease-in-out;
            border-color: #ef4444 !important;
            background-color: #fee2e2 !important;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .hidden { display: none !important; }
        #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 40; }

        /* Renkler */
        .btn-red { background-color: #ef4444; color: white; border-bottom-color: #b91c1c; }
        .btn-green { background-color: #22c55e; color: white; border-bottom-color: #15803d; }
    </style>
</head>
<body>

    <canvas id="confetti"></canvas>

    <div class="lang-container">
        <button onclick="setLanguage('tr')" id="btn-tr" class="lang-btn active">üáπüá∑</button>
        <button onclick="setLanguage('en')" id="btn-en" class="lang-btn">üá¨üáß</button>
    </div>

    <!-- START SCREEN -->
    <div id="start-screen" class="app-layout justify-center items-center text-center" style="display: flex; overflow-y: auto;">
        <div class="w-full py-10">
            <h1 id="title-main" class="text-5xl font-bold text-blue-500 mb-6">√áarpƒ±m<br>Canavarƒ±</h1>
            
            <div class="bg-white p-4 rounded-2xl shadow-sm border-2 border-blue-100 mb-6 w-full max-w-sm mx-auto">
                <p id="label-choose-char" class="text-gray-500 mb-2 font-bold">Karakterini Se√ß:</p>
                <div class="emoji-grid" id="emoji-grid"></div>
            </div>
            
            <div class="w-full max-w-sm mx-auto mb-6">
                <input type="text" id="player-name-input" placeholder="Adƒ±n ne?" class="w-full text-center text-2xl p-4 rounded-xl border-4 border-blue-200 focus:border-blue-500 outline-none text-gray-700 placeholder-gray-300">
                <p id="name-warning" class="text-red-500 text-sm mt-2 opacity-0 transition-opacity">L√ºtfen bir isim yaz!</p>
            </div>

            <button id="btn-start" onclick="startGame()" class="w-full max-w-sm py-4 text-2xl font-bold rounded-2xl btn-green shadow-lg active:scale-95 transition-transform text-white border-b-4 border-green-700">
                BA≈ûLA!
            </button>
        </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="app-layout hidden">
        
        <!-- HEADER (SKOR) -->
        <div class="header-section flex justify-between items-center">
            <div class="bg-yellow-100 px-3 py-2 rounded-xl border-b-4 border-yellow-300 flex items-center gap-2">
                <span id="label-score" class="score-text text-yellow-700 font-bold text-sm">Yƒ±ldƒ±z:</span>
                <span id="score" class="score-val text-xl font-bold text-yellow-600">0</span>
            </div>
            <div class="bg-purple-100 px-3 py-2 rounded-xl border-b-4 border-purple-300 flex items-center gap-2">
                <span id="label-streak" class="score-text text-purple-700 font-bold text-sm">Seri:</span>
                <span id="streak" class="score-val text-xl font-bold text-purple-600">0</span>
            </div>
        </div>

        <!-- SORU ALANI -->
        <div id="question-box" class="question-section">
            <div id="feedback-message" class="absolute top-4 font-bold text-lg text-gray-400 opacity-0 transition-opacity text-center w-full px-2">Harika!</div>
            
            <!-- Flex wrap yok, yan yana kalmaya zorluyoruz -->
            <div class="flex items-center justify-center gap-2 mt-2">
                <span id="factor1" class="q-text text-6xl md:text-7xl font-bold text-gray-700">?</span>
                <span class="q-text text-4xl md:text-5xl text-blue-400 font-bold">x</span>
                <span id="factor2" class="q-text text-6xl md:text-7xl font-bold text-gray-700">?</span>
            </div>
            
            <div class="mt-4 flex items-center gap-2">
                <span class="text-4xl text-gray-300">=</span>
                <div id="user-answer" class="ans-box h-16 min-w-[100px] bg-gray-100 rounded-xl flex items-center justify-center text-5xl font-bold text-blue-600 border-2 border-dashed border-gray-300"></div>
            </div>

            <div id="correct-answer-display" class="absolute bottom-0 w-full bg-red-100 text-red-500 py-2 text-center font-bold transform translate-y-full transition-transform rounded-b-[1.3rem]">
                <span id="label-answer">Cevap:</span> <span id="real-answer" class="text-2xl">0</span>
            </div>
        </div>

        <!-- NUMPAD -->
        <div class="numpad-section">
            <button onclick="addNumber(1)" class="numpad-btn">1</button>
            <button onclick="addNumber(2)" class="numpad-btn">2</button>
            <button onclick="addNumber(3)" class="numpad-btn">3</button>
            
            <button onclick="addNumber(4)" class="numpad-btn">4</button>
            <button onclick="addNumber(5)" class="numpad-btn">5</button>
            <button onclick="addNumber(6)" class="numpad-btn">6</button>
            
            <button onclick="addNumber(7)" class="numpad-btn">7</button>
            <button onclick="addNumber(8)" class="numpad-btn">8</button>
            <button onclick="addNumber(9)" class="numpad-btn">9</button>
            
            <button onclick="deleteNumber()" id="btn-del" class="numpad-btn btn-red">Sƒ∞L</button>
            <button onclick="addNumber(0)" class="numpad-btn">0</button>
            <button onclick="checkAnswer()" class="numpad-btn btn-green">OK</button>
        </div>
    </div>

    <script>
        const translations = {
            tr: {
                titleMain: "√áarpƒ±m<br>Canavarƒ±",
                placeholderName: "Adƒ±n ne?",
                labelChar: "Karakterini Se√ß:",
                btnStart: "BA≈ûLA!",
                labelScore: "Yƒ±ldƒ±z:",
                labelStreak: "Seri:",
                labelAnswer: "Cevap:",
                btnDel: "Sƒ∞L",
                warningName: "L√ºtfen bir isim yaz!",
                praises: ["Harika", "S√ºper", "Doƒüru", "Aferin", "M√ºthi≈üsin", "Efsanesin", "Deha", "≈ûim≈üek", "Durmak Yok", "ƒ∞nanƒ±lmaz"],
                tryAgain: "Tekrar dene"
            },
            en: {
                titleMain: "Math<br>Monster",
                placeholderName: "What's your name?",
                labelChar: "Choose Character:",
                btnStart: "START!",
                labelScore: "Star:",
                labelStreak: "Streak:",
                labelAnswer: "Answer:",
                btnDel: "DEL",
                warningName: "Enter a name!",
                praises: ["Great", "Super", "Correct", "Awesome", "Amazing", "Legendary", "Genius", "Fast", "Unstoppable", "Incredible"],
                tryAgain: "Try again"
            }
        };

        let currentLang = 'tr';
        let playerName = "";
        let playerEmoji = "ü¶Å"; 
        const emojisToSelect = ["ü¶Å", "üêØ", "üêº", "üê®", "ü¶Ñ", "üöÄ", "ü¶ñ", "ü§ñ", "‚≠ê", "üê±"];

        function initEmojiGrid() {
            const grid = document.getElementById('emoji-grid');
            grid.innerHTML = "";
            emojisToSelect.forEach(emoji => {
                const btn = document.createElement('div');
                btn.innerText = emoji;
                btn.className = `emoji-option ${emoji === playerEmoji ? 'selected' : ''}`;
                btn.onclick = () => selectEmoji(emoji, btn);
                grid.appendChild(btn);
            });
        }

        function selectEmoji(emoji, btnElement) {
            playerEmoji = emoji;
            document.querySelectorAll('.emoji-option').forEach(el => el.classList.remove('selected'));
            btnElement.classList.add('selected');
        }

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.getElementById('title-main').innerHTML = t.titleMain;
            document.getElementById('player-name-input').placeholder = t.placeholderName;
            document.getElementById('label-choose-char').innerText = t.labelChar;
            document.getElementById('btn-start').innerText = t.btnStart;
            document.getElementById('label-score').innerText = t.labelScore;
            document.getElementById('label-streak').innerText = t.labelStreak;
            document.getElementById('label-answer').innerText = t.labelAnswer;
            document.getElementById('btn-del').innerText = t.btnDel;
            document.getElementById('name-warning').innerText = t.warningName;
            document.getElementById('btn-tr').classList.toggle('active', lang === 'tr');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
        }

        let currentFactor1 = 1, currentFactor2 = 1, currentInput = "", score = 0, streak = 0;
        let questionWeights = {};
        const MAX_WEIGHT = 20, MIN_WEIGHT = 1, WEIGHT_PENALTY = 5, WEIGHT_REWARD = 1;

        function initWeights() {
            for(let i=1; i<=9; i++) {
                for(let j=1; j<=9; j++) {
                    let weight = 1;
                    if (i >= 5 || j >= 5) weight = 4;
                    if (i >= 5 && j >= 5) weight = 10;
                    if (i === 1 || j === 1) weight = 1;
                    questionWeights[`${i}x${j}`] = weight;
                }
            }
        }

        function startGame() {
            const nameInput = document.getElementById('player-name-input');
            const warning = document.getElementById('name-warning');
            if(nameInput.value.trim() === "") {
                warning.style.opacity = "1";
                nameInput.classList.add('shake');
                setTimeout(() => nameInput.classList.remove('shake'), 400);
                return;
            }
            playerName = nameInput.value.trim();
            initWeights();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            generateQuestion();
        }

        function generateQuestion() {
            let totalWeight = 0;
            const keys = Object.keys(questionWeights);
            keys.forEach(key => totalWeight += questionWeights[key]);
            let randomNum = Math.random() * totalWeight;
            let selectedKey = keys[keys.length - 1];
            for (let key of keys) {
                randomNum -= questionWeights[key];
                if (randomNum <= 0) { selectedKey = key; break; }
            }
            const parts = selectedKey.split('x');
            if(parts[0] == currentFactor1 && parts[1] == currentFactor2 && keys.length > 1) {
                generateQuestion(); return;
            }
            currentFactor1 = parseInt(parts[0]);
            currentFactor2 = parseInt(parts[1]);
            
            if(Math.random() > 0.5) {
                document.getElementById('factor1').innerText = currentFactor1;
                document.getElementById('factor2').innerText = currentFactor2;
            } else {
                document.getElementById('factor1').innerText = currentFactor2;
                document.getElementById('factor2').innerText = currentFactor1;
            }
            currentInput = "";
            updateInputDisplay();
            const qBox = document.getElementById('question-box');
            qBox.classList.remove('shake');
            qBox.classList.remove('border-green-400');
            qBox.style.borderColor = '#3b82f6';
            document.getElementById('correct-answer-display').classList.add('translate-y-full');
        }

        function addNumber(num) {
            if (currentInput.length < 3) {
                currentInput += num;
                updateInputDisplay();
            }
        }

        function deleteNumber() {
            currentInput = currentInput.slice(0, -1);
            updateInputDisplay();
        }

        function updateInputDisplay() {
            const display = document.getElementById('user-answer');
            display.innerText = currentInput;
            if(currentInput === "") {
                display.classList.add('border-dashed');
                display.classList.remove('bg-white');
            } else {
                display.classList.remove('border-dashed');
                display.classList.add('bg-white');
            }
        }

        function checkAnswer() {
            if (currentInput === "") return;
            const userAnswer = parseInt(currentInput);
            const correctAnswer = currentFactor1 * currentFactor2;
            const key = `${currentFactor1}x${currentFactor2}`;
            const keyReverse = `${currentFactor2}x${currentFactor1}`;

            if (userAnswer === correctAnswer) {
                handleCorrect(key, keyReverse);
            } else {
                handleWrong(key, keyReverse, correctAnswer);
            }
        }

        function handleCorrect(key, keyReverse) {
            score += 10;
            streak++;
            questionWeights[key] = Math.max(MIN_WEIGHT, questionWeights[key] - WEIGHT_REWARD);
            if(questionWeights[keyReverse]) questionWeights[keyReverse] = questionWeights[key];

            document.getElementById('score').innerText = score;
            document.getElementById('streak').innerText = streak;
            
            const qBox = document.getElementById('question-box');
            qBox.classList.add('border-green-400');
            qBox.style.borderColor = '#4ade80';
            
            const fb = document.getElementById('feedback-message');
            fb.innerText = getRandomPraise() + " " + playerEmoji + " " + playerName + "!";
            fb.style.opacity = '1';
            fb.classList.add('text-green-500');
            fireConfetti();
            spawnEmojis('happy'); 
            setTimeout(() => {
                fb.style.opacity = '0';
                fb.classList.remove('text-green-500');
                generateQuestion();
            }, 1200);
        }

        function handleWrong(key, keyReverse, correctAnswer) {
            streak = 0;
            questionWeights[key] = Math.min(MAX_WEIGHT, questionWeights[key] + WEIGHT_PENALTY);
            if(questionWeights[keyReverse]) questionWeights[keyReverse] = questionWeights[key];

            document.getElementById('streak').innerText = streak;
            const qBox = document.getElementById('question-box');
            qBox.classList.add('shake');
            const answerDisplay = document.getElementById('correct-answer-display');
            document.getElementById('real-answer').innerText = correctAnswer;
            answerDisplay.classList.remove('translate-y-full');
            const fb = document.getElementById('feedback-message');
            fb.innerText = translations[currentLang].tryAgain + "!";
            fb.style.opacity = '1';
            fb.classList.add('text-red-500');
            spawnEmojis('sad');
            setTimeout(() => {
                qBox.classList.remove('shake');
                answerDisplay.classList.add('translate-y-full');
                fb.style.opacity = '0';
                fb.classList.remove('text-red-500');
                currentInput = "";
                updateInputDisplay();
                generateQuestion();
            }, 2000);
        }

        function getRandomPraise() {
            const praises = translations[currentLang].praises;
            return praises[Math.floor(Math.random() * praises.length)];
        }

        const happyEmojis = ['üéâ', 'üåü', 'üëè', 'ü•≥', 'üíØ', '‚≠ê']; 
        const sadEmojis = ['üò¢', 'üò≠', 'ü•∫', 'ü§î', '‚ùå', '‚õî'];
        function spawnEmojis(type) {
            const count = 10; 
            let currentList = type === 'happy' ? [...happyEmojis, playerEmoji] : sadEmojis;
            for (let i = 0; i < count; i++) {
                const emoji = document.createElement('span');
                emoji.innerText = currentList[Math.floor(Math.random() * currentList.length)];
                emoji.classList.add('emoji-animated');
                emoji.style.left = (Math.random() * 80 + 10) + "%";
                emoji.style.top = (Math.random() * 50 + 20) + "%";
                document.body.appendChild(emoji);
                setTimeout(() => { emoji.remove(); }, 1500);
            }
        }

        const canvas = document.getElementById("confetti");
        const ctx = canvas.getContext("2d");
        let particles = [];
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        function fireConfetti() {
            for (let i = 0; i < 40; i++) particles.push({ x: canvas.width/2, y: canvas.height/2, vx: (Math.random()-0.5)*20, vy: (Math.random()-1)*20, color: `hsl(${Math.random()*360},100%,50%)`, size: Math.random()*8+4, life: 1 });
            if (particles.length <= 40) requestAnimationFrame(updateConfetti);
        }
        function updateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, index) => {
                p.x += p.vx; p.y += p.vy; p.vy += 0.5; p.life -= 0.02; p.size *= 0.95;
                ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
                if (p.life <= 0) particles.splice(index, 1);
            });
            if (particles.length > 0) requestAnimationFrame(updateConfetti);
        }
        setLanguage('tr');
        initEmojiGrid();
    </script>
</body>
</html>
