<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>Multiplication Monster - 2 in 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        
        :root {
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
            --app-height: 100dvh;
        }

        * {
            box-sizing: border-box;
            touch-action: none; /* Oyunlar iÃ§in genel kaydÄ±rmayÄ± engelle */
            user-select: none;
            -webkit-user-select: none;
        }

        /* Ä°sim giriÅŸi ve butonlar iÃ§in dokunmayÄ± serbest bÄ±rak */
        input, button {
            touch-action: manipulation;
            user-select: auto; 
            -webkit-user-select: auto;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f9ff;
            margin: 0;
            padding: 0;
            height: var(--app-height);
            width: 100vw;
            overflow: hidden;
        }

        /* ORTAK YAPILAR */
        .full-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }

        .hidden { display: none !important; }

        .btn-push {
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn-push:active {
            transform: translateY(4px);
            box-shadow: none !important;
        }

        /* KARAKTER SEÃ‡Ä°MÄ° */
        .emoji-slider-wrapper { width: 100%; overflow: hidden; border-radius: 16px; position: relative; }
        .emoji-slider {
            display: flex; overflow-x: auto; gap: 20px;
            padding: 15px calc(50% - 35px); width: 100%;
            scrollbar-width: none; cursor: grab; 
            scroll-behavior: smooth; /* JS ile kontrol edilecek */
        }
        .emoji-slider.active { cursor: grabbing; scroll-behavior: auto !important; }
        .emoji-slider::-webkit-scrollbar { display: none; }
        
        .char-item {
            font-size: 2.8rem; padding: 5px; border: 4px solid transparent;
            border-radius: 18px; transition: all 0.3s; flex-shrink: 0;
            width: 70px; height: 70px; display: flex; align-items: center; justify-content: center;
            background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            cursor: pointer;
        }
        .char-item.selected {
            background: #eff6ff; border-color: #3b82f6;
            transform: scale(1.15) translateY(-5px);
            box-shadow: 0 10px 15px rgba(59, 130, 246, 0.2);
            z-index: 10;
        }

        /* OYUN 1: KLASÄ°K (NUMPAD) */
        .numpad-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; height: 100%;
        }
        .key-btn {
            background: white; border: none; border-bottom: 5px solid #e5e7eb;
            border-radius: 16px; font-size: 1.8rem; font-weight: 600; color: #4b5563;
            display: flex; align-items: center; justify-content: center;
        }
        .key-btn:active { transform: translateY(3px); border-bottom-width: 2px; }
        .key-del { background: #fca5a5; color: white; border-bottom-color: #ef4444; }
        .key-ok { background: #86efac; color: white; border-bottom-color: #22c55e; }

        /* OYUN 2: BALONLAR */
        #balloon-container {
            position: relative; flex: 1; overflow: hidden; width: 100%;
            background: linear-gradient(to bottom, #bae6fd, #f0f9ff);
        }
        .balloon {
            position: absolute; width: 70px; height: 90px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; animation: floatUp 0.5s ease-out; z-index: 10;
        }
        .balloon-circle {
            width: 60px; height: 70px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: bold; color: white;
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .balloon-string {
            width: 2px; height: 20px; background: rgba(0,0,0,0.2); margin-top: -2px;
        }
        /* Balon Patlama Animasyonu */
        @keyframes pop { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.4); opacity: 0.8; } 100% { transform: scale(0); opacity: 0; } }
        .popped { animation: pop 0.2s forwards !important; pointer-events: none; }

        /* Animasyonlar */
        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
        
        .floating-score { position: absolute; font-weight: bold; font-size: 1.5rem; color: #fbbf24; animation: floatUpScore 1s forwards; pointer-events: none; z-index: 100; text-shadow: 1px 1px 0 #000; }
        @keyframes floatUpScore { 0% {transform:translateY(0); opacity:1} 100% {transform:translateY(-50px); opacity:0} }

        /* YENÄ°: UÃ§uÅŸan Emojiler */
        .floating-emoji { 
            position: fixed; pointer-events: none; z-index: 100; font-size: 3rem; 
            animation: floatUpEmoji 1.5s ease-out forwards; 
        }
        @keyframes floatUpEmoji { 
            0% {transform:translateY(0) scale(0.5); opacity:1} 
            100% {transform:translateY(-200px) scale(1.5); opacity:0} 
        }

    </style>
</head>
<body>

    <canvas id="confetti" style="position:fixed; top:0; left:0; pointer-events:none; z-index:9999;"></canvas>

    <!-- 1. BAÅLANGIÃ‡ EKRANI (Ä°sim & Karakter) -->
    <div id="start-view" class="full-screen items-center justify-center p-4">
        <h1 id="title-txt" class="text-5xl font-bold text-blue-500 mb-6 text-center leading-tight">Ã‡arpÄ±m<br>CanavarÄ±</h1>
        
        <div class="w-full max-w-md bg-white p-4 rounded-3xl shadow-lg border-2 border-blue-100 mb-6">
            <p id="lbl-char" class="text-gray-400 font-bold text-center text-xs uppercase tracking-wider mb-2">KARAKTERÄ°NÄ° SEÃ‡</p>
            <div class="emoji-slider-wrapper">
                <div id="char-slider" class="emoji-slider"></div>
            </div>
        </div>

        <div class="w-full max-w-md mb-6">
            <input id="p-name" type="text" placeholder="AdÄ±n ne?" class="w-full text-center text-2xl p-4 rounded-2xl border-4 border-blue-200 outline-none text-gray-700 bg-white focus:border-blue-400 transition-colors placeholder-gray-300">
        </div>

        <button id="btn-next" onclick="goToMenu()" class="w-full max-w-md py-4 text-2xl font-bold rounded-2xl bg-blue-500 text-white shadow-[0_4px_0_#1d4ed8] btn-push mb-8">
            Ä°LERÄ°
        </button>

        <div class="flex gap-4 opacity-60">
            <button onclick="setLang('tr')" class="text-3xl hover:scale-110 transition-transform">ğŸ‡¹ğŸ‡·</button>
            <button onclick="setLang('en')" class="text-3xl hover:scale-110 transition-transform">ğŸ‡¬ğŸ‡§</button>
        </div>
    </div>

    <!-- 2. OYUN MENÃœSÃœ -->
    <div id="menu-view" class="full-screen hidden items-center p-4 bg-indigo-50">
        <div class="w-full flex justify-between items-center mb-6 max-w-md">
            <button onclick="goBackStart()" class="bg-white p-2 rounded-xl shadow border border-gray-200 text-xl">â¬…ï¸</button>
            <div class="text-xl font-bold text-indigo-800"><span id="player-display"></span> <span id="char-display"></span></div>
        </div>

        <h2 id="lbl-select-game" class="text-2xl font-bold text-indigo-400 mb-6">OYUN SEÃ‡</h2>

        <div class="flex flex-col gap-4 w-full max-w-md">
            <!-- Oyun 1 -->
            <button onclick="startGame('classic')" class="relative overflow-hidden bg-white p-6 rounded-3xl shadow-lg border-b-8 border-blue-200 active:border-b-0 active:translate-y-2 transition-all flex items-center gap-4 group">
                <div class="text-5xl bg-blue-100 p-3 rounded-2xl">ğŸ§®</div>
                <div class="text-left">
                    <div id="g1-title" class="text-2xl font-bold text-gray-700 group-hover:text-blue-500">Klasik</div>
                    <div id="g1-desc" class="text-sm text-gray-400">Soruyu bil, klavyeyle yaz</div>
                </div>
            </button>

            <!-- Oyun 2 -->
            <button onclick="startGame('balloon')" class="relative overflow-hidden bg-white p-6 rounded-3xl shadow-lg border-b-8 border-pink-200 active:border-b-0 active:translate-y-2 transition-all flex items-center gap-4 group">
                <div class="text-5xl bg-pink-100 p-3 rounded-2xl">ğŸˆ</div>
                <div class="text-left">
                    <div id="g2-title" class="text-2xl font-bold text-gray-700 group-hover:text-pink-500">Balonlar</div>
                    <div id="g2-desc" class="text-sm text-gray-400">DoÄŸru balonu patlat!</div>
                </div>
            </button>
        </div>
    </div>

    <!-- OYUN 1: KLASÄ°K GÃ–RÃœNÃœM -->
    <div id="game-classic" class="full-screen hidden bg-blue-50">
        <!-- Ãœst Bar -->
        <div class="flex justify-between items-center px-4 mb-4">
            <button onclick="endGame()" class="bg-white px-3 py-1 rounded-lg text-sm font-bold text-gray-500 shadow">âŒ Ã‡IKIÅ</button>
            <div class="flex gap-2">
                 <!-- SERÄ° ROZETÄ° -->
                 <div class="bg-purple-100 text-purple-700 px-3 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[50px]">
                    <small class="lbl-streak text-[10px] opacity-70">SERÄ°</small>
                    <span id="c-streak">0</span>
                </div>
                <!-- PUAN ROZETÄ° -->
                <div class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[50px]">
                    <small class="lbl-score text-[10px] opacity-70">PUAN</small>
                    <span id="c-score">0</span>
                </div>
            </div>
        </div>

        <!-- Soru KartÄ± -->
        <div class="flex-1 flex justify-center items-center p-4">
            <div id="c-card" class="bg-white w-full max-w-sm rounded-3xl shadow-xl border-4 border-blue-400 p-6 flex flex-col items-center relative">
                <!-- KLASÄ°K GERÄ° BÄ°LDÄ°RÄ°M ALANI -->
                <div id="c-feedback" class="absolute -top-16 w-full text-center text-3xl font-bold text-green-500 opacity-0 transition-opacity drop-shadow-sm">Harika!</div>
                
                <div class="flex items-center gap-4 text-gray-700 font-bold mb-6">
                    <span id="c-n1" class="text-6xl">?</span>
                    <span class="text-4xl text-blue-300">Ã—</span>
                    <span id="c-n2" class="text-6xl">?</span>
                </div>
                <div class="flex items-center gap-4 w-full justify-center">
                    <span class="text-4xl text-gray-400">=</span>
                    <div id="c-ans-box" class="bg-gray-100 w-32 h-20 rounded-xl border-4 border-dashed border-gray-300 flex items-center justify-center text-4xl text-blue-600 font-bold"></div>
                </div>
            </div>
        </div>

        <!-- Klavye -->
        <div class="h-[40%] max-h-[350px] p-4 bg-white rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
            <div class="numpad-grid max-w-md mx-auto">
                <button class="key-btn" onclick="cInput(1)">1</button>
                <button class="key-btn" onclick="cInput(2)">2</button>
                <button class="key-btn" onclick="cInput(3)">3</button>
                <button class="key-btn" onclick="cInput(4)">4</button>
                <button class="key-btn" onclick="cInput(5)">5</button>
                <button class="key-btn" onclick="cInput(6)">6</button>
                <button class="key-btn" onclick="cInput(7)">7</button>
                <button class="key-btn" onclick="cInput(8)">8</button>
                <button class="key-btn" onclick="cInput(9)">9</button>
                <button class="key-btn key-del" onclick="cDel()">Sil</button>
                <button class="key-btn" onclick="cInput(0)">0</button>
                <button class="key-btn key-ok" onclick="cCheck()">OK</button>
            </div>
        </div>
    </div>

    <!-- OYUN 2: BALON GÃ–RÃœNÃœMÃœ -->
    <div id="game-balloon" class="full-screen hidden">
        <!-- Soru Paneli (Ãœstte Sabit) -->
        <div class="absolute top-0 left-0 w-full z-20 pt-[var(--safe-top)]">
            <div class="mx-4 mt-2 bg-white/90 backdrop-blur rounded-2xl shadow-lg border-b-4 border-blue-300 p-2 flex justify-between items-center">
                <button onclick="endGame()" class="text-2xl">âŒ</button>
                <div class="flex items-center gap-2 text-3xl font-bold text-slate-700">
                    <span id="b-n1"></span> <span class="text-blue-400">Ã—</span> <span id="b-n2"></span> <span class="text-gray-400">=</span> <span class="text-blue-600">?</span>
                </div>
                <div class="flex gap-2">
                    <!-- SERÄ° ROZETÄ° -->
                    <div class="bg-purple-100 text-purple-700 px-3 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[50px]">
                        <small class="lbl-streak text-[10px] opacity-70">SERÄ°</small>
                        <span id="b-streak">0</span>
                    </div>
                    <!-- PUAN ROZETÄ° -->
                    <div class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[50px]">
                        <small class="lbl-score text-[10px] opacity-70">PUAN</small>
                        <span id="b-score">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- BALON GERÄ° BÄ°LDÄ°RÄ°M ALANI -->
        <div id="b-feedback" class="absolute top-24 left-0 w-full text-center text-4xl font-bold text-white z-30 pointer-events-none opacity-0 transition-opacity" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Harika!</div>
        
        <!-- Balon AlanÄ± -->
        <div id="balloon-container"></div>
    </div>

    <script>
        // --- Ã‡EVÄ°RÄ° VE VERÄ°TABANI ---
        const DB = {
            tr: {
                t: "Ã‡arpÄ±m<br>CanavarÄ±", p: "AdÄ±n ne?", c: "KARAKTERÄ°NÄ° SEÃ‡", btn: "Ä°LERÄ°",
                sel: "OYUN SEÃ‡",
                g1: "Klasik", g1d: "Soruyu bil, klavyeyle yaz",
                g2: "Balonlar", g2d: "DoÄŸru balonu patlat!",
                back: "Ã‡IKIÅ",
                ls: "PUAN", lstr: "SERÄ°",
                pr: ["Harika", "SÃ¼per", "DoÄŸru", "Aferin", "MÃ¼thiÅŸ", "Efsane", "Deha", "ÅimÅŸek", "SÃ¼persin"],
                sad: ["ÃœzÃ¼lme!", "Tekrar Dene", "Pes Etme", "Seri Bozuldu :(", "Yapabilirsin!", "Az KaldÄ±!"],
                milestone: ["DurdurulamazsÄ±n!", "Efsanevi Seri!", "Matematik DehasÄ±!", "Ä°nanÄ±lmaz!", "AteÅŸ Ediyorsun! ğŸ”¥"]
            },
            en: {
                t: "Math<br>Monster", p: "Your Name?", c: "CHOOSE CHARACTER", btn: "NEXT",
                sel: "SELECT GAME",
                g1: "Classic", g1d: "Type the answer",
                g2: "Balloons", g2d: "Pop the correct balloon!",
                back: "EXIT",
                ls: "SCORE", lstr: "STREAK",
                pr: ["Great", "Super", "Correct", "Awesome", "Amazing", "Legend", "Genius", "Fast", "Perfect"],
                sad: ["Don't be sad", "Try Again", "Don't Give Up", "Streak Lost :(", "You Can Do It", "So Close!"],
                milestone: ["Unstoppable!", "Legendary Streak!", "Math Genius!", "Incredible!", "On Fire! ğŸ”¥"]
            }
        };

        let lang = 'tr';
        let pName = '', pChar = 'ğŸ¦';
        let currentMode = null;
        let score = 0;
        let streak = 0; // YENÄ°: Seri sayacÄ±
        let qData = { n1: 1, n2: 1, ans: 1 };
        const emojis = ["ğŸ¦", "ğŸ¯", "ğŸ¼", "ğŸ¨", "ğŸ¦„", "ğŸš€", "ğŸ¦–", "ğŸ¤–", "â­", "ğŸ±", "ğŸ¶", "ğŸ¸"];

        // --- BAÅLANGIÃ‡ & MENÃœ ---
        function init() {
            renderCharSlider();
            setLang('tr');
        }

        function renderCharSlider() {
            const slider = document.getElementById('char-slider');
            
            // --- Drag Logic Start (Mouse + Touch) ---
            let isDown = false;
            let startX;
            let scrollLeft;
            let isDragging = false; 

            // MOUSE EVENTS
            slider.addEventListener('mousedown', (e) => {
                isDown = true;
                isDragging = false;
                slider.style.scrollBehavior = 'auto'; // SMOOTH KAPAT
                slider.classList.add('active');
                startX = e.pageX;
                scrollLeft = slider.scrollLeft;
            });
            
            const endDrag = () => {
                isDown = false;
                slider.classList.remove('active');
                slider.style.scrollBehavior = 'smooth'; // SMOOTH AÃ‡
            };
            
            slider.addEventListener('mouseleave', endDrag);
            slider.addEventListener('mouseup', endDrag);
            
            slider.addEventListener('mousemove', (e) => {
                if(!isDown) return;
                e.preventDefault();
                const x = e.pageX;
                const walk = (startX - x) * 2; 
                if(Math.abs(walk) > 5) isDragging = true;
                slider.scrollLeft = scrollLeft + walk;
            });

            // TOUCH EVENTS - Telefondaki Ã§akÄ±ÅŸmayÄ± Ã¶nlemek iÃ§in gÃ¼ncellendi
            slider.addEventListener('touchstart', (e) => {
                isDown = true;
                isDragging = false;
                slider.style.scrollBehavior = 'auto'; // SÃ¼rÃ¼klerken animasyonu kapat
                startX = e.touches[0].pageX;
                scrollLeft = slider.scrollLeft;
            }, {passive: false});

            slider.addEventListener('touchend', () => {
                isDown = false;
                slider.style.scrollBehavior = 'smooth'; // BÄ±rakÄ±nca animasyonu aÃ§
            });

            slider.addEventListener('touchmove', (e) => {
                if(!isDown) return;
                // e.preventDefault(); // Sayfa kaymasÄ±nÄ± engelle
                const x = e.touches[0].pageX;
                const walk = (startX - x) * 2; 
                if(Math.abs(walk) > 5) isDragging = true;
                slider.scrollLeft = scrollLeft + walk;
            }, {passive: false});

            // --- Drag Logic End ---

            emojis.forEach(e => {
                const d = document.createElement('div');
                d.className = `char-item ${e===pChar?'selected':''}`;
                d.innerText = e;
                
                d.onclick = (event) => {
                    if(isDragging) return; // SÃ¼rÃ¼klerken seÃ§me
                    pChar = e;
                    document.querySelectorAll('.char-item').forEach(x => x.classList.remove('selected'));
                    d.classList.add('selected');
                    centerEmoji(d);
                };
                slider.appendChild(d);
            });

            // BaÅŸlangÄ±Ã§ta ortala
            setTimeout(() => {
                const sel = slider.querySelector('.selected');
                if(sel) centerEmoji(sel);
            }, 100);
        }

        function centerEmoji(el) {
            const slider = document.getElementById('char-slider');
            const sliderRect = slider.getBoundingClientRect();
            const elRect = el.getBoundingClientRect();
            const offset = (elRect.left + elRect.width / 2) - (sliderRect.left + sliderRect.width / 2);
            slider.scrollTo({
                left: slider.scrollLeft + offset,
                behavior: 'smooth'
            });
        }

        function setLang(l) {
            lang = l;
            const d = DB[l];
            document.getElementById('title-txt').innerHTML = d.t;
            document.getElementById('p-name').placeholder = d.p;
            document.getElementById('lbl-char').innerText = d.c;
            document.getElementById('btn-next').innerText = d.btn;
            document.getElementById('lbl-select-game').innerText = d.sel;
            
            document.getElementById('g1-title').innerText = d.g1; document.getElementById('g1-desc').innerText = d.g1d;
            document.getElementById('g2-title').innerText = d.g2; document.getElementById('g2-desc').innerText = d.g2d;

            // Etiketleri gÃ¼ncelle
            document.querySelectorAll('.lbl-score').forEach(el => el.innerText = d.ls);
            document.querySelectorAll('.lbl-streak').forEach(el => el.innerText = d.lstr);
        }

        function goToMenu() {
            const nm = document.getElementById('p-name');
            if(!nm.value.trim()) { nm.classList.add('shake'); setTimeout(()=>nm.classList.remove('shake'),400); return; }
            pName = nm.value.trim();
            
            document.getElementById('start-view').classList.add('hidden');
            document.getElementById('menu-view').classList.remove('hidden');
            document.getElementById('menu-view').classList.add('flex', 'flex-col');
            
            document.getElementById('player-display').innerText = pName;
            document.getElementById('char-display').innerText = pChar;
        }

        function goBackStart() {
            document.getElementById('menu-view').classList.add('hidden');
            document.getElementById('menu-view').classList.remove('flex');
            document.getElementById('start-view').classList.remove('hidden');
        }

        function startGame(mode) {
            currentMode = mode;
            score = 0;
            streak = 0; // Seriyi sÄ±fÄ±rla
            document.getElementById('menu-view').classList.add('hidden');
            document.getElementById('menu-view').classList.remove('flex');

            if(mode === 'classic') initClassic();
            if(mode === 'balloon') initBalloon();
        }

        function endGame() {
            // Temizlik
            if(balloonInterval) clearInterval(balloonInterval);
            document.getElementById('balloon-container').innerHTML = '';

            // GÃ¶rÃ¼nÃ¼m kapat
            document.getElementById('game-classic').classList.add('hidden');
            document.getElementById('game-balloon').classList.add('hidden');

            // MenÃ¼ye dÃ¶n
            document.getElementById('menu-view').classList.remove('hidden');
            document.getElementById('menu-view').classList.add('flex');
        }

        // --- ORTAK MATEMATÄ°K FONKSÄ°YONLARI ---
        function generateQ() {
            // Basit aÄŸÄ±rlÄ±klÄ± seÃ§im simÃ¼lasyonu
            let a = Math.floor(Math.random() * 9) + 1;
            let b = Math.floor(Math.random() * 9) + 1;
            // 1x1 gibi Ã§ok basitleri daha az sor, 6x8 gibileri daha Ã§ok (basit mantÄ±k)
            if(Math.random() > 0.7) { a = Math.floor(Math.random()*5)+5; b = Math.floor(Math.random()*5)+5; }
            
            qData = { n1: a, n2: b, ans: a*b };
            return qData;
        }

        function showConfetti() {
            // Basit confetti tetikleyicisi
            for(let i=0;i<30;i++) parts.push({x:window.innerWidth/2,y:window.innerHeight/2,vx:(Math.random()-.5)*20,vy:(Math.random()-1)*20,c:`hsl(${Math.random()*360},100%,50%)`});
            if(!animating) { animating=true; loopConfetti(); }
        }

        function getPraise() {
            // 10'lu seri kontrolÃ¼
            if (streak > 0 && streak % 10 === 0) {
                const milestones = DB[lang].milestone;
                return milestones[Math.floor(Math.random() * milestones.length)] + " " + streak + "!";
            }
            const list = DB[lang].pr;
            const word = list[Math.floor(Math.random() * list.length)];
            return `${word} ${pName} ${pChar}`;
        }

        function getSadMessage() {
            const list = DB[lang].sad;
            const word = list[Math.floor(Math.random() * list.length)];
            return `${word} ${pName}`;
        }

        function showFeedback(elId, type = 'praise') {
            const el = document.getElementById(elId);
            if(!el) return;
            
            if(type === 'sad') {
                el.innerText = getSadMessage();
                el.style.color = '#ef4444'; // KÄ±rmÄ±zÄ±
            } else {
                el.innerText = getPraise();
                el.style.color = (streak > 0 && streak % 10 === 0) ? '#a855f7' : '#22c55e'; // Mor (10'lu) veya YeÅŸil
            }

            el.style.opacity = 1;
            el.style.transform = "scale(1.2)";
            el.style.transition = "all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
            
            setTimeout(() => {
                el.style.transform = "scale(1)";
                el.style.opacity = 0;
            }, 1500); // Biraz daha uzun kalsÄ±n
        }

        function spawnEmoji(isHappy) {
            let list = isHappy ? ['ğŸ‰','â­', 'âœ¨', 'ğŸˆ', pChar] : ['ğŸ’©','ğŸ¥€','ğŸŒ§ï¸','âŒ','ğŸ¤”'];
            // EÄŸer 10'lu seriyse daha coÅŸkulu
            if(isHappy && streak % 10 === 0) list = ['ğŸ†', 'ğŸš€', 'ğŸ‘‘', 'ğŸ”¥', 'ğŸ’¯'];

            // 5-8 arasÄ± emoji fÄ±rlat
            const count = 5 + Math.floor(Math.random() * 4);
            
            for(let i=0; i<count; i++) {
                let el = document.createElement('div');
                el.innerText = list[Math.floor(Math.random()*list.length)];
                el.className = 'floating-emoji';
                el.style.left = (10 + Math.random()*80) + '%';
                el.style.top = (40 + Math.random()*30) + '%';
                // Rastgele gecikme
                el.style.animationDelay = (Math.random() * 0.5) + 's';
                document.body.appendChild(el);
                setTimeout(()=>el.remove(), 2000);
            }
        }


        function updateStreakUI() {
            document.getElementById('c-streak').innerText = streak;
            document.getElementById('b-streak').innerText = streak;
        }

        // --- OYUN 1: KLASÄ°K ---
        let cInp = '';
        function initClassic() {
            const el = document.getElementById('game-classic');
            el.classList.remove('hidden');
            el.classList.add('flex', 'flex-col');
            document.getElementById('c-score').innerText = score;
            updateStreakUI();
            newClassicQ();
        }

        function newClassicQ() {
            generateQ();
            document.getElementById('c-n1').innerText = qData.n1;
            document.getElementById('c-n2').innerText = qData.n2;
            cInp = '';
            updCInp();
            document.getElementById('c-card').style.borderColor = '#60a5fa'; // Blue
        }

        function cInput(n) { if(cInp.length<3) { cInp+=n; updCInp(); } }
        function cDel() { cInp=cInp.slice(0,-1); updCInp(); }
        function updCInp() {
            const box = document.getElementById('c-ans-box');
            box.innerText = cInp;
            box.style.borderStyle = cInp ? 'solid' : 'dashed';
            box.style.backgroundColor = cInp ? 'white' : '#f3f4f6';
        }

        function cCheck() {
            if(!cInp) return;
            const val = parseInt(cInp);
            const card = document.getElementById('c-card');
            if(val === qData.ans) {
                score += 10;
                streak++; // Seri arttÄ±r
                document.getElementById('c-score').innerText = score;
                updateStreakUI();

                card.style.borderColor = '#22c55e'; // Green
                
                showFeedback('c-feedback', 'praise'); // MesajÄ± gÃ¶ster
                spawnEmoji(true); // Emojileri uÃ§ur
                showConfetti();
                
                setTimeout(newClassicQ, 800);
            } else {
                streak = 0; // Seri sÄ±fÄ±rla
                updateStreakUI();
                showFeedback('c-feedback', 'sad'); // ÃœzgÃ¼n mesaj
                spawnEmoji(false); // ÃœzgÃ¼n emojiler
                
                card.classList.add('shake');
                card.style.borderColor = '#ef4444'; // Red
                setTimeout(()=>card.classList.remove('shake'), 400);
                cInp=''; updCInp();
            }
        }

        // --- OYUN 2: BALONLAR ---
        let balloonInterval;
        let balloonSpeed = 2; // BaÅŸlangÄ±Ã§ hÄ±zÄ±

        function initBalloon() {
            const el = document.getElementById('game-balloon');
            el.classList.remove('hidden');
            el.classList.add('flex', 'flex-col');
            document.getElementById('b-score').innerText = score;
            updateStreakUI();
            newBalloonLevel();
            startGameLoop_Balloon();
        }

        function newBalloonLevel() {
            generateQ();
            document.getElementById('b-n1').innerText = qData.n1;
            document.getElementById('b-n2').innerText = qData.n2;
            
            // Mevcut balonlarÄ± temizle
            document.getElementById('balloon-container').innerHTML = '';
            
            // BalonlarÄ± oluÅŸtur (1 DoÄŸru, 3 YanlÄ±ÅŸ)
            let answers = [qData.ans];
            while(answers.length < 4) {
                let r = qData.ans + Math.floor(Math.random()*10) - 5;
                if(r > 0 && !answers.includes(r)) answers.push(r);
            }
            answers.sort(() => Math.random() - 0.5);

            // --- YENÄ° KISIM: Åerit Sistemi ---
            // EkranÄ± %10, %32, %54, %76 gibi 4 ÅŸeride bÃ¶lÃ¼yoruz (+rastgelelik)
            let lanes = [10, 32, 54, 76];
            // Her ÅŸeride ufak bir kayma payÄ± ekle (daha doÄŸal dursun)
            lanes = lanes.map(l => l + (Math.random() * 5 - 2.5));
            // Åeritleri karÄ±ÅŸtÄ±r ki cevap hep aynÄ± yerde Ã§Ä±kmasÄ±n
            lanes.sort(() => Math.random() - 0.5);

            answers.forEach((ans, i) => {
                // Her balona bir ÅŸerit ata
                createBalloon(ans, i * 200, lanes[i]); 
            });
        }

        function createBalloon(val, delay, leftPos) {
            const cont = document.getElementById('balloon-container');
            const b = document.createElement('div');
            b.className = 'balloon';
            
            // EÄŸer Ã¶zel bir pozisyon (ÅŸerit) verildiyse onu kullan, yoksa rastgele
            let finalLeft = (leftPos !== undefined) ? leftPos : (10 + Math.random() * 60);
            b.style.left = finalLeft + '%';
            
            b.style.top = '-100px';
            b.dataset.val = val;
            
            // Renkler
            const colors = ['#fca5a5', '#86efac', '#93c5fd', '#fcd34d', '#d8b4fe'];
            const color = colors[Math.floor(Math.random()*colors.length)];

            b.innerHTML = `
                <div class="balloon-circle" style="background:${color};">${val}</div>
                <div class="balloon-string"></div>
            `;
            
            b.onclick = (e) => checkBalloon(b, val, e);
            
            setTimeout(() => {
                // Parent kontrolÃ¼ kaldÄ±rÄ±ldÄ±, oyun hala aÃ§Ä±ksa ekle
                if(!document.getElementById('game-balloon').classList.contains('hidden')) {
                    cont.appendChild(b);
                    animateBalloon(b);
                }
            }, delay);
        }

        function animateBalloon(el) {
            let pos = -100;
            const speed = 1.5 + Math.random(); // Her balonun hÄ±zÄ± biraz farklÄ±
            
            function frame() {
                // ParentNode kontrolÃ¼ yerine oyunun aÃ§Ä±k olup olmadÄ±ÄŸÄ±na bakabiliriz
                if(!el.parentNode && !el.classList.contains('popped')) return; 
                if(el.classList.contains('popped')) return;

                pos += speed;
                el.style.top = pos + 'px';
                
                if(pos > window.innerHeight) {
                    // Balon ekran dÄ±ÅŸÄ±na Ã§Ä±ktÄ±, ÅŸeridini kaybetmeden yenisini oluÅŸtur
                    let currentLane = parseFloat(el.style.left); 
                    el.remove();
                    
                    // EÄŸer oyun kapalÄ±ysa yeni balon Ã¼retme
                    if(document.getElementById('game-balloon').classList.contains('hidden')) return;

                    // EÄŸer doÄŸru cevap kaÃ§tÄ±ysa yenisini Ã¼ret
                    if(parseInt(el.dataset.val) === qData.ans) {
                        createBalloon(qData.ans, 0, currentLane); // AynÄ± ÅŸeritten tekrar at
                    } else {
                        // YanlÄ±ÅŸ cevap dÃ¼ÅŸtÃ¼yse yerine baÅŸka rastgele yanlÄ±ÅŸ at
                        let wrong = qData.ans + Math.floor(Math.random()*10)+1;
                        createBalloon(wrong, 0, currentLane); // AynÄ± ÅŸeritten tekrar at
                    }
                } else {
                    requestAnimationFrame(frame);
                }
            }
            requestAnimationFrame(frame);
        }

        function checkBalloon(el, val, e) {
            if(val === qData.ans) {
                score += 10;
                streak++; // Seri arttÄ±r
                document.getElementById('b-score').innerText = score;
                updateStreakUI();
                el.classList.add('popped');
                
                // Puan efekti
                const floatScore = document.createElement('div');
                floatScore.className = 'floating-score';
                floatScore.innerText = '+10';
                floatScore.style.left = e.clientX + 'px';
                floatScore.style.top = e.clientY + 'px';
                document.body.appendChild(floatScore);
                setTimeout(()=>floatScore.remove(), 1000);

                showFeedback('b-feedback', 'praise'); // Balon modunda mesajÄ± gÃ¶ster
                spawnEmoji(true); // Emojileri uÃ§ur
                showConfetti();
                
                // DiÄŸer balonlarÄ± patlat ve yeni soruya geÃ§
                setTimeout(newBalloonLevel, 500);
            } else {
                streak = 0; // Seri sÄ±fÄ±rla
                updateStreakUI();
                showFeedback('b-feedback', 'sad');
                spawnEmoji(false);
                
                // YanlÄ±ÅŸ cevap
                el.classList.add('shake');
                setTimeout(()=>el.classList.remove('shake'), 400);
                score = Math.max(0, score - 5);
                document.getElementById('b-score').innerText = score;
            }
        }

        function startGameLoop_Balloon() {
            // Ana dÃ¶ngÃ¼ye gerek kalmadÄ±, her balon kendi animasyonuna sahip
        }

        // --- EFEKT (CONFETTI) ---
        const cvsC = document.getElementById('confetti');
        const ctxC = cvsC.getContext('2d');
        let parts = [], animating = false;
        
        function resizeConfetti() { cvsC.width=window.innerWidth; cvsC.height=window.innerHeight; }
        window.onresize = () => { resizeConfetti(); };
        resizeConfetti();

        function loopConfetti(){
            ctxC.clearRect(0,0,cvsC.width,cvsC.height);
            parts.forEach((p,i)=>{
                p.x+=p.vx; p.y+=p.vy; p.vy+=0.5;
                ctxC.fillStyle=p.c; ctxC.beginPath(); ctxC.arc(p.x,p.y,5,0,7); ctxC.fill();
                if(p.y>cvsC.height) parts.splice(i,1);
            });
            if(parts.length) requestAnimationFrame(loopConfetti);
            else animating = false;
        }

        // BaÅŸlat
        init();

    </script>
</body>
</html>
