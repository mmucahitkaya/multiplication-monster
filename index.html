<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>Multiplication Monster</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');
        
        :root {
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
            --app-height: 100dvh;
        }

        * {
            box-sizing: border-box;
            touch-action: manipulation; 
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f9ff;
            margin: 0;
            padding: 0;
            height: var(--app-height);
            width: 100vw;
            overflow: hidden;
            user-select: none;
        }

        /* ANA ƒ∞SKELET */
        .main-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }

        /* 1. √úST PANEL */
        .top-bar {
            flex: 0 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            width: 100%;
            z-index: 20;
        }

        .stats-group {
            display: flex;
            gap: 10px;
        }

        .stat-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px 12px;
            border-radius: 12px;
            min-width: 70px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-bottom: 3px solid rgba(0,0,0,0.1);
        }
        
        .stat-label { font-size: 0.8rem; font-weight: bold; opacity: 0.8; }
        .stat-value { font-size: 1.4rem; font-weight: bold; line-height: 1.2; }

        .bg-yellow { background: #fef3c7; color: #b45309; }
        .bg-purple { background: #f3e8ff; color: #7e22ce; }

        /* Dil Se√ßimi */
        .lang-switch {
            display: flex;
            gap: 5px;
            background: white;
            padding: 4px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .lang-btn {
            font-size: 1.5rem;
            line-height: 1;
            padding: 2px;
            border-radius: 50%;
            opacity: 0.4;
            filter: grayscale(100%);
            transition: all 0.2s;
            border: none;
            background: none;
        }
        .lang-btn.active {
            opacity: 1;
            filter: grayscale(0);
            transform: scale(1.1);
            background: #eff6ff;
        }

        /* 2. ORTA PANEL */
        .game-area {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            position: relative;
        }

        .question-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.1);
            border: 3px solid #3b82f6;
            width: 100%;
            height: 100%;
            max-height: 280px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden; 
        }

        .operation-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 20px;
        }
        
        .num-text { font-size: clamp(4rem, 10vh, 6rem); }
        .op-text { font-size: clamp(2rem, 5vh, 3rem); color: #60a5fa; }
        
        .answer-area {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .answer-box {
            background: #f3f4f6;
            min-width: 100px;
            height: 70px;
            border-radius: 16px;
            border: 3px dashed #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #2563eb;
            font-weight: bold;
        }

        .feedback-toast {
            position: absolute;
            top: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #9ca3af;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .correct-answer-toast {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: #fee2e2;
            color: #ef4444;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            border-radius: 0; 
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 3. ALT PANEL */
        .controls-area {
            flex: 0 0 auto;
            padding: 10px 15px;
            height: 40%;
            max-height: 380px;
        }

        .numpad-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 8px;
            height: 100%;
        }

        .key-btn {
            background: white;
            border: none;
            border-bottom: 5px solid #e5e7eb;
            border-radius: 16px;
            font-size: 1.8rem;
            font-weight: 600;
            color: #4b5563;
            cursor: pointer;
            transition: transform 0.1s;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        .key-btn:active {
            transform: translateY(3px);
            border-bottom-width: 2px;
        }

        .key-del { background: #fca5a5; color: white; border-bottom-color: #ef4444; font-size: 1.4rem; }
        .key-ok { background: #86efac; color: white; border-bottom-color: #22c55e; font-size: 1.4rem; }

        /* Ba≈ülangƒ±√ß Ekranƒ± */
        .start-scroll-container {
            overflow-y: auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .emoji-slider-wrapper {
            width: 100%;
            overflow: hidden;
            border-radius: 16px;
            position: relative;
        }

        .emoji-slider {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            /* √ñNEMLƒ∞: Ba≈ütaki ve sondaki elemanlarƒ±n ortaya gelebilmesi i√ßin %50 bo≈üluk */
            padding: 15px calc(50% - 35px); 
            width: 100%;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            cursor: grab;
            scroll-behavior: smooth;
        }
        .emoji-slider.active {
            cursor: grabbing;
            scroll-behavior: auto;
        }
        .emoji-slider::-webkit-scrollbar { display: none; }
        
        .char-item {
            font-size: 2.8rem;
            padding: 5px;
            border: 4px solid transparent;
            border-radius: 18px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            flex-shrink: 0;
            cursor: pointer;
            user-select: none;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .char-item.selected {
            background: #eff6ff;
            border-color: #3b82f6;
            transform: scale(1.15) translateY(-5px);
            box-shadow: 0 10px 15px rgba(59, 130, 246, 0.2);
            z-index: 10;
        }

        .hidden { display: none !important; }
        .shake { animation: shake 0.4s ease-in-out; border-color: #ef4444 !important; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
        
        .floating-emoji { position: fixed; pointer-events: none; z-index: 100; font-size: 3rem; animation: floatUp 1.5s ease-out forwards; }
        @keyframes floatUp { 0% {transform:translateY(0) scale(0.5); opacity:1} 100% {transform:translateY(-300px) scale(1.2); opacity:0} }

    </style>
</head>
<body>

    <canvas id="confetti" style="position:fixed; top:0; left:0; pointer-events:none; z-index:50;"></canvas>

    <!-- OYUN ALANI -->
    <div id="game-view" class="main-layout hidden">
        
        <!-- 1. √úST BAR -->
        <div class="top-bar">
            <div class="stats-group">
                <div class="stat-badge bg-yellow">
                    <span id="lbl-score" class="stat-label">YILDIZ</span>
                    <span id="score-val" class="stat-value">0</span>
                </div>
                <div class="stat-badge bg-purple">
                    <span id="lbl-streak" class="stat-label">SERƒ∞</span>
                    <span id="streak-val" class="stat-value">0</span>
                </div>
            </div>

            <div class="lang-switch">
                <button onclick="setLang('tr')" id="btn-tr" class="lang-btn active">üáπüá∑</button>
                <button onclick="setLang('en')" id="btn-en" class="lang-btn">üá¨üáß</button>
            </div>
        </div>

        <!-- 2. SORU KARTI -->
        <div class="game-area">
            <div id="q-card" class="question-card">
                <div id="feedback" class="feedback-toast">Harika!</div>

                <div class="operation-row">
                    <span id="n1" class="num-text">?</span>
                    <span class="op-text">√ó</span>
                    <span id="n2" class="num-text">?</span>
                </div>

                <div class="answer-area">
                    <span class="op-text">=</span>
                    <div id="ans-box" class="answer-box"></div>
                </div>

                <div id="correct-toast" class="correct-answer-toast">
                    <span id="lbl-ans">Cevap:</span> <span id="real-ans">0</span>
                </div>
            </div>
        </div>

        <!-- 3. TU≈ûLAR -->
        <div class="controls-area">
            <div class="numpad-grid">
                <button class="key-btn" onclick="input(1)">1</button>
                <button class="key-btn" onclick="input(2)">2</button>
                <button class="key-btn" onclick="input(3)">3</button>
                <button class="key-btn" onclick="input(4)">4</button>
                <button class="key-btn" onclick="input(5)">5</button>
                <button class="key-btn" onclick="input(6)">6</button>
                <button class="key-btn" onclick="input(7)">7</button>
                <button class="key-btn" onclick="input(8)">8</button>
                <button class="key-btn" onclick="input(9)">9</button>
                <button id="btn-del" class="key-btn key-del" onclick="del()">Sƒ∞L</button>
                <button class="key-btn" onclick="input(0)">0</button>
                <button class="key-btn key-ok" onclick="check()">OK</button>
            </div>
        </div>
    </div>

    <!-- BA≈ûLANGI√á EKRANI -->
    <div id="start-view" class="main-layout">
        <div class="start-scroll-container">
            <h1 id="title" class="text-5xl font-bold text-blue-500 mb-6 text-center">√áarpƒ±m<br>Canavarƒ±</h1>
            
            <div class="w-full bg-blue-50 p-2 rounded-2xl border border-blue-100 mb-6 shadow-inner">
                <p id="lbl-char" class="text-gray-500 mb-2 font-bold text-center text-sm uppercase tracking-wider mt-2">Karakterini Se√ß</p>
                <div class="emoji-slider-wrapper">
                    <div id="char-slider" class="emoji-slider"></div>
                </div>
            </div>

            <div class="w-full mb-6 px-4">
                <input id="p-name" type="text" placeholder="Adƒ±n ne?" class="w-full text-center text-2xl p-4 rounded-xl border-4 border-blue-200 outline-none text-gray-700 bg-white focus:border-blue-400 transition-colors" autocomplete="off">
            </div>

            <div class="w-full px-4">
                <button id="btn-start" onclick="startGame()" class="w-full py-4 text-2xl font-bold rounded-2xl bg-green-500 text-white shadow-[0_4px_0_#15803d] active:shadow-none active:translate-y-[4px] transition-all">
                    BA≈ûLA!
                </button>
            </div>
            
            <div class="mt-8 flex gap-4 justify-center opacity-70">
                <button onclick="setLang('tr')" class="text-4xl hover:scale-110 transition-transform">üáπüá∑</button>
                <button onclick="setLang('en')" class="text-4xl hover:scale-110 transition-transform">üá¨üáß</button>
            </div>
        </div>
    </div>

    <script>
        const DB = {
            tr: {
                t: "√áarpƒ±m<br>Canavarƒ±", p: "Adƒ±n ne?", c: "KARAKTERƒ∞Nƒ∞ SE√á", b: "BA≈ûLA!",
                ls: "YILDIZ", lstr: "SERƒ∞", la: "Cevap:", bd: "Sƒ∞L",
                w: "L√ºtfen bir isim yaz!", try: "Tekrar dene",
                pr: ["Harika", "S√ºper", "Doƒüru", "Aferin", "M√ºthi≈ü", "Efsane", "Deha", "≈ûim≈üek", "S√ºpersin"]
            },
            en: {
                t: "Math<br>Monster", p: "Your Name?", c: "CHOOSE CHARACTER", b: "START!",
                ls: "STAR", lstr: "STREAK", la: "Answer:", bd: "DEL",
                w: "Enter a name!", try: "Try again",
                pr: ["Great", "Super", "Correct", "Awesome", "Amazing", "Legend", "Genius", "Fast", "Perfect"]
            }
        };

        let lang='tr', pName='', pChar='ü¶Å', n1=1, n2=1, inp='', sc=0, str=0, weights={};
        const emojis = ["ü¶Å", "üêØ", "üêº", "üê®", "ü¶Ñ", "üöÄ", "ü¶ñ", "ü§ñ", "‚≠ê", "üê±", "üê∂", "üê∏"];

        function init() {
            const slider = document.getElementById('char-slider');
            
            // Mouse Drag Mantƒ±ƒüƒ±
            let isDown = false;
            let startX;
            let scrollLeft;
            let isDragging = false; 

            slider.addEventListener('mousedown', (e) => {
                isDown = true;
                isDragging = false;
                slider.classList.add('active');
                startX = e.pageX - slider.offsetLeft;
                scrollLeft = slider.scrollLeft;
            });

            slider.addEventListener('mouseleave', () => { isDown = false; slider.classList.remove('active'); });
            slider.addEventListener('mouseup', () => { isDown = false; slider.classList.remove('active'); });

            slider.addEventListener('mousemove', (e) => {
                if(!isDown) return;
                e.preventDefault();
                const x = e.pageX - slider.offsetLeft;
                const walk = (x - startX) * 2; 
                if(Math.abs(walk) > 5) {
                    isDragging = true;
                    slider.scrollLeft = scrollLeft - walk;
                }
            });

            emojis.forEach(e => {
                const d = document.createElement('div');
                d.className = `char-item ${e===pChar?'selected':''}`;
                d.innerText = e;
                
                d.onclick = (event) => {
                    if(isDragging) return;
                    pChar = e;
                    document.querySelectorAll('.char-item').forEach(x => x.classList.remove('selected'));
                    d.classList.add('selected');
                    centerEmoji(d);
                };
                slider.appendChild(d);
            });
            
            // Ba≈ülangƒ±√ßta ortala
            setTimeout(() => {
                const selected = slider.querySelector('.selected');
                if(selected) centerEmoji(selected);
            }, 100);

            setLang('tr');
        }

        // --- YENƒ∞ ORTALAMA FONKSƒ∞YONU ---
        function centerEmoji(el) {
            const slider = document.getElementById('char-slider');
            const sliderRect = slider.getBoundingClientRect();
            const elRect = el.getBoundingClientRect();
            
            // Elemanƒ±n merkezi ile Slider'ƒ±n merkezi arasƒ±ndaki farkƒ± bul
            const offset = (elRect.left + elRect.width / 2) - (sliderRect.left + sliderRect.width / 2);
            
            // Mevcut scroll pozisyonuna bu farkƒ± ekle
            slider.scrollTo({
                left: slider.scrollLeft + offset,
                behavior: 'smooth'
            });
        }

        function setLang(l) {
            lang = l;
            const d = DB[l];
            document.getElementById('title').innerHTML = d.t;
            document.getElementById('lbl-char').innerText = d.c;
            document.getElementById('p-name').placeholder = d.p;
            document.getElementById('btn-start').innerText = d.b;
            
            document.getElementById('lbl-score').innerText = d.ls;
            document.getElementById('lbl-streak').innerText = d.lstr;
            document.getElementById('lbl-ans').innerText = d.la;
            document.getElementById('btn-del').innerText = d.bd;
            
            document.getElementById('btn-tr').classList.toggle('active', l==='tr');
            document.getElementById('btn-en').classList.toggle('active', l==='en');
        }

        function startGame() {
            const nm = document.getElementById('p-name');
            if(!nm.value.trim()) {
                nm.classList.add('shake'); setTimeout(()=>nm.classList.remove('shake'),400);
                return;
            }
            pName = nm.value.trim();
            
            for(let i=1;i<=9;i++) for(let j=1;j<=9;j++) {
                let w = 1;
                if(i>=5 || j>=5) w=4;
                if(i>=5 && j>=5) w=10;
                weights[`${i}x${j}`] = w;
            }

            document.getElementById('start-view').classList.add('hidden');
            document.getElementById('game-view').classList.remove('hidden');
            document.getElementById('game-view').classList.add('flex');
            newQ();
        }

        function newQ() {
            let tot=0, keys=Object.keys(weights);
            keys.forEach(k => tot+=weights[k]);
            let r = Math.random()*tot;
            let sel = keys[keys.length-1];
            for(let k of keys) {
                r -= weights[k];
                if(r<=0) { sel=k; break; }
            }
            let [a,b] = sel.split('x').map(Number);
            if(a===n1 && b===n2 && keys.length>1) return newQ();
            
            n1=a; n2=b;
            document.getElementById('n1').innerText = n1;
            document.getElementById('n2').innerText = n2;
            
            inp='';
            updInp();
            document.getElementById('q-card').style.borderColor = '#3b82f6';
            document.getElementById('correct-toast').style.transform = 'translateY(100%)';
        }

        function input(n) { if(inp.length<3) { inp+=n; updInp(); } }
        function del() { inp=inp.slice(0,-1); updInp(); }
        function updInp() {
            const b = document.getElementById('ans-box');
            b.innerText = inp;
            b.style.borderStyle = inp ? 'solid' : 'dashed';
            b.style.background = inp ? 'white' : '#f3f4f6';
        }

        function check() {
            if(!inp) return;
            let ans = parseInt(inp);
            let real = n1*n2;
            let k = `${n1}x${n2}`, kr = `${n2}x${n1}`;

            if(ans === real) {
                sc+=10; str++;
                weights[k] = Math.max(1, weights[k]-1);
                if(weights[kr]) weights[kr] = weights[k];
                showFeed(true);
            } else {
                str=0;
                weights[k] = Math.min(20, weights[k]+5);
                if(weights[kr]) weights[kr] = weights[k];
                showFeed(false, real);
            }
            document.getElementById('score-val').innerText = sc;
            document.getElementById('streak-val').innerText = str;
        }

        function showFeed(isCorrect, real) {
            const fb = document.getElementById('feedback');
            const card = document.getElementById('q-card');
            
            if(isCorrect) {
                fb.innerText = DB[lang].pr[Math.floor(Math.random()*DB[lang].pr.length)] + " " + pChar;
                fb.style.color = '#22c55e';
                card.style.borderColor = '#22c55e';
                fb.style.opacity = 1;
                confetti();
                spawnEmoji(true);
                setTimeout(() => {
                    fb.style.opacity = 0;
                    newQ();
                }, 1000);
            } else {
                fb.innerText = DB[lang].try;
                fb.style.color = '#ef4444';
                card.classList.add('shake');
                document.getElementById('real-ans').innerText = real;
                document.getElementById('correct-toast').style.transform = 'translateY(0)';
                fb.style.opacity = 1;
                spawnEmoji(false);
                setTimeout(() => {
                    card.classList.remove('shake');
                    fb.style.opacity = 0;
                    newQ();
                }, 2000);
            }
        }

        function spawnEmoji(happy) {
            let list = happy ? ['üéâ','‚≠ê', pChar] : ['‚ùå','ü§î','üí®'];
            for(let i=0; i<8; i++) {
                let el = document.createElement('div');
                el.innerText = list[Math.floor(Math.random()*list.length)];
                el.className = 'floating-emoji';
                el.style.left = (20 + Math.random()*60) + '%';
                el.style.top = (40 + Math.random()*20) + '%';
                document.body.appendChild(el);
                setTimeout(()=>el.remove(), 1500);
            }
        }

        const cvs=document.getElementById('confetti'), ctx=cvs.getContext('2d');
        let parts=[];
        function sz(){cvs.width=window.innerWidth;cvs.height=window.innerHeight}
        window.onresize=sz; sz();
        function confetti(){
            for(let i=0;i<40;i++) parts.push({x:cvs.width/2,y:cvs.height/2,vx:(Math.random()-.5)*20,vy:(Math.random()-1)*20,c:`hsl(${Math.random()*360},100%,50%)`});
            loop();
        }
        function loop(){
            ctx.clearRect(0,0,cvs.width,cvs.height);
            parts.forEach((p,i)=>{p.x+=p.vx;p.y+=p.vy;p.vy+=.5;ctx.fillStyle=p.c;ctx.beginPath();ctx.arc(p.x,p.y,5,0,7);ctx.fill();if(p.y>cvs.height)parts.splice(i,1)});
            if(parts.length)requestAnimationFrame(loop);
        }

        init();
    </script>
</body>
</html>
