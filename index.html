<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>Multiplication Monster - Ultimate Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        
        :root {
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
            --app-height: 100dvh;
        }

        * {
            box-sizing: border-box;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        input, button, a {
            touch-action: manipulation;
            user-select: auto; 
            -webkit-user-select: auto;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f9ff;
            margin: 0;
            padding: 0;
            height: var(--app-height);
            width: 100vw;
            overflow: hidden;
        }

        /* ORTAK YAPILAR */
        .full-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }

        .hidden { display: none !important; }

        .btn-push {
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn-push:active {
            transform: translateY(4px);
            box-shadow: none !important;
        }

        /* KARAKTER SE√áƒ∞Mƒ∞ */
        .emoji-slider-wrapper { width: 100%; overflow: hidden; border-radius: 16px; position: relative; }
        .emoji-slider {
            display: flex; overflow-x: auto; gap: 20px;
            padding: 15px calc(50% - 35px); width: 100%;
            scrollbar-width: none; cursor: grab; 
            scroll-behavior: smooth;
        }
        .emoji-slider.active { cursor: grabbing; scroll-behavior: auto !important; }
        .emoji-slider::-webkit-scrollbar { display: none; }
        
        .char-item {
            font-size: 2.8rem; padding: 5px; border: 4px solid transparent;
            border-radius: 18px; transition: all 0.3s; flex-shrink: 0;
            width: 70px; height: 70px; display: flex; align-items: center; justify-content: center;
            background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            cursor: pointer;
        }
        .char-item.selected {
            background: #eff6ff; border-color: #3b82f6;
            transform: scale(1.15) translateY(-5px);
            box-shadow: 0 10px 15px rgba(59, 130, 246, 0.2);
            z-index: 10;
        }

        /* OYUN 1: KLASƒ∞K (NUMPAD) */
        .numpad-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; height: 100%;
        }
        .key-btn {
            background: white; border: none; border-bottom: 5px solid #e5e7eb;
            border-radius: 16px; font-size: 1.8rem; font-weight: 600; color: #4b5563;
            display: flex; align-items: center; justify-content: center;
        }
        .key-btn:active { transform: translateY(3px); border-bottom-width: 2px; }
        .key-del { background: #fca5a5; color: white; border-bottom-color: #ef4444; }
        .key-ok { background: #86efac; color: white; border-bottom-color: #22c55e; }

        /* OYUN 2: BALONLAR */
        #balloon-container {
            position: relative; flex: 1; overflow: hidden; width: 100%;
            background: linear-gradient(to bottom, #bae6fd, #f0f9ff);
        }
        .balloon {
            position: absolute; width: 70px; height: 90px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; animation: floatUp 0.5s ease-out; z-index: 10;
        }
        .balloon-circle {
            width: 60px; height: 70px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: bold; color: white;
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .balloon-string {
            width: 2px; height: 20px; background: rgba(0,0,0,0.2); margin-top: -2px;
        }
        @keyframes pop { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.4); opacity: 0.8; } 100% { transform: scale(0); opacity: 0; } }
        .popped { animation: pop 0.2s forwards !important; pointer-events: none; }

        /* Animasyonlar */
        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
        
        .floating-score { position: absolute; font-weight: bold; font-size: 1.5rem; color: #fbbf24; animation: floatUpScore 1s forwards; pointer-events: none; z-index: 100; text-shadow: 1px 1px 0 #000; }
        @keyframes floatUpScore { 0% {transform:translateY(0); opacity:1} 100% {transform:translateY(-50px); opacity:0} }

        .floating-emoji { 
            position: fixed; pointer-events: none; z-index: 100; font-size: 3rem; 
            animation: floatUpEmoji 1.5s ease-out forwards; 
        }
        @keyframes floatUpEmoji { 
            0% {transform:translateY(0) scale(0.5); opacity:1} 
            100% {transform:translateY(-200px) scale(1.5); opacity:0} 
        }

    </style>
</head>
<body>

    <canvas id="confetti" style="position:fixed; top:0; left:0; pointer-events:none; z-index:9999;"></canvas>

    <!-- 1. BA≈ûLANGI√á EKRANI -->
    <div id="start-view" class="full-screen items-center justify-center p-4 relative">
        <h1 id="title-txt" class="text-5xl font-bold text-blue-500 mb-6 text-center leading-tight">√áarpƒ±m<br>Canavarƒ±</h1>
        
        <div class="w-full max-w-md bg-white p-4 rounded-3xl shadow-lg border-2 border-blue-100 mb-6">
            <p id="lbl-char" class="text-gray-400 font-bold text-center text-xs uppercase tracking-wider mb-2">KARAKTERƒ∞Nƒ∞ SE√á</p>
            <div class="emoji-slider-wrapper">
                <div id="char-slider" class="emoji-slider"></div>
            </div>
        </div>

        <div class="w-full max-w-md mb-6">
            <input id="p-name" type="text" placeholder="Adƒ±n ne?" class="w-full text-center text-2xl p-4 rounded-2xl border-4 border-blue-200 outline-none text-gray-700 bg-white focus:border-blue-400 transition-colors placeholder-gray-300">
        </div>

        <button id="btn-next" onclick="goToMenu()" class="w-full max-w-md py-4 text-2xl font-bold rounded-2xl bg-blue-500 text-white shadow-[0_4px_0_#1d4ed8] btn-push mb-8">
            ƒ∞LERƒ∞
        </button>

        <div class="flex gap-4 opacity-60">
            <button onclick="setLang('tr')" class="text-3xl hover:scale-110 transition-transform">üáπüá∑</button>
            <button onclick="setLang('en')" class="text-3xl hover:scale-110 transition-transform">üá¨üáß</button>
        </div>

        <a href="https://github.com/mmucahitkaya/multiplication-monster" target="_blank" class="absolute bottom-[calc(var(--safe-bottom)+10px)] right-4 text-blue-300 hover:text-blue-500 transition-colors opacity-70 hover:opacity-100" title="GitHub">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg>
        </a>
    </div>

    <!-- 2. OYUN MEN√úS√ú -->
    <div id="menu-view" class="full-screen hidden items-center p-4 bg-indigo-50">
        <div class="w-full flex justify-between items-center mb-6 max-w-md">
            <button onclick="goBackStart()" class="bg-white p-2 rounded-xl shadow border border-gray-200 text-xl">‚¨ÖÔ∏è</button>
            <div class="text-xl font-bold text-indigo-800"><span id="player-display"></span> <span id="char-display"></span></div>
        </div>

        <h2 id="lbl-select-game" class="text-2xl font-bold text-indigo-400 mb-6">OYUN SE√á</h2>

        <div class="flex flex-col gap-4 w-full max-w-md">
            <button onclick="startGame('classic')" class="relative overflow-hidden bg-white p-6 rounded-3xl shadow-lg border-b-8 border-blue-200 active:border-b-0 active:translate-y-2 transition-all flex items-center gap-4 group">
                <div class="text-5xl bg-blue-100 p-3 rounded-2xl">üßÆ</div>
                <div class="text-left">
                    <div id="g1-title" class="text-2xl font-bold text-gray-700 group-hover:text-blue-500">Klasik</div>
                    <div id="g1-desc" class="text-sm text-gray-400">Soruyu bil, klavyeyle yaz</div>
                </div>
            </button>

            <button onclick="startGame('balloon')" class="relative overflow-hidden bg-white p-6 rounded-3xl shadow-lg border-b-8 border-pink-200 active:border-b-0 active:translate-y-2 transition-all flex items-center gap-4 group">
                <div class="text-5xl bg-pink-100 p-3 rounded-2xl">üéà</div>
                <div class="text-left">
                    <div id="g2-title" class="text-2xl font-bold text-gray-700 group-hover:text-pink-500">Balonlar</div>
                    <div id="g2-desc" class="text-sm text-gray-400">Doƒüru balonu patlat!</div>
                </div>
            </button>
        </div>
    </div>

    <!-- OYUN 1: KLASƒ∞K G√ñR√úN√úM -->
    <div id="game-classic" class="full-screen hidden bg-blue-50">
        <!-- √úst Bar -->
        <div class="flex justify-between items-center px-4 mb-4">
            <button onclick="endGame()" class="bg-white px-3 py-1 rounded-lg text-sm font-bold text-gray-500 shadow">‚ùå √áIKI≈û</button>
            <div class="flex gap-2">
                <!-- S√úRE -->
                <div class="bg-red-50 text-red-600 px-2 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[45px]">
                    <small class="text-[9px] opacity-70">S√úRE</small>
                    <span id="c-timer">30</span>
                </div>
                <!-- CAN -->
                <div class="bg-red-50 text-red-600 px-2 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[45px]">
                    <small class="lbl-lives text-[9px] opacity-70">CAN</small>
                    <span id="c-lives">3</span>
                </div>
                <!-- SERƒ∞ -->
                <div class="bg-purple-100 text-purple-700 px-2 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[45px]">
                    <small class="lbl-streak text-[9px] opacity-70">SERƒ∞</small>
                    <span id="c-streak">0</span>
                </div>
                <!-- PUAN -->
                <div class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[45px]">
                    <small class="lbl-score text-[9px] opacity-70">PUAN</small>
                    <span id="c-score">0</span>
                </div>
            </div>
        </div>

        <!-- Soru Kartƒ± -->
        <div class="flex-1 flex justify-center items-center p-4">
            <div id="c-card" class="bg-white w-full max-w-sm rounded-3xl shadow-xl border-4 border-blue-400 p-6 flex flex-col items-center relative">
                <div id="c-feedback" class="absolute -top-16 w-full text-center text-3xl font-bold text-green-500 opacity-0 transition-opacity drop-shadow-sm">Harika!</div>
                
                <div class="flex items-center gap-4 text-gray-700 font-bold mb-6">
                    <span id="c-n1" class="text-6xl">?</span>
                    <span class="text-4xl text-blue-300">√ó</span>
                    <span id="c-n2" class="text-6xl">?</span>
                </div>
                <div class="flex items-center gap-4 w-full justify-center">
                    <span class="text-4xl text-gray-400">=</span>
                    <div id="c-ans-box" class="bg-gray-100 w-32 h-20 rounded-xl border-4 border-dashed border-gray-300 flex items-center justify-center text-4xl text-blue-600 font-bold"></div>
                </div>
            </div>
        </div>

        <!-- Klavye -->
        <div class="h-[40%] max-h-[350px] p-4 bg-white rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
            <div class="numpad-grid max-w-md mx-auto">
                <button class="key-btn" onclick="cInput(1)">1</button>
                <button class="key-btn" onclick="cInput(2)">2</button>
                <button class="key-btn" onclick="cInput(3)">3</button>
                <button class="key-btn" onclick="cInput(4)">4</button>
                <button class="key-btn" onclick="cInput(5)">5</button>
                <button class="key-btn" onclick="cInput(6)">6</button>
                <button class="key-btn" onclick="cInput(7)">7</button>
                <button class="key-btn" onclick="cInput(8)">8</button>
                <button class="key-btn" onclick="cInput(9)">9</button>
                <button class="key-btn key-del" onclick="cDel()">Sil</button>
                <button class="key-btn" onclick="cInput(0)">0</button>
                <button class="key-btn key-ok" onclick="cCheck()">OK</button>
            </div>
        </div>
    </div>

    <!-- OYUN 2: BALON G√ñR√úN√úM√ú -->
    <div id="game-balloon" class="full-screen hidden">
        <!-- Soru Paneli -->
        <div class="absolute top-0 left-0 w-full z-20 pt-[var(--safe-top)]">
            <div class="mx-4 mt-2 bg-white/90 backdrop-blur rounded-2xl shadow-lg border-b-4 border-blue-300 p-2 flex justify-between items-center">
                <button onclick="endGame()" class="text-2xl">‚ùå</button>
                <div class="flex items-center gap-2 text-3xl font-bold text-slate-700">
                    <span id="b-n1"></span> <span class="text-blue-400">√ó</span> <span id="b-n2"></span> <span class="text-gray-400">=</span> <span class="text-blue-600">?</span>
                </div>
                <div class="flex gap-2">
                    <!-- CAN -->
                    <div class="bg-red-50 text-red-600 px-2 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[45px]">
                        <small class="lbl-lives text-[9px] opacity-70">CAN</small>
                        <span id="b-lives">3</span>
                    </div>
                    <!-- SERƒ∞ -->
                    <div class="bg-purple-100 text-purple-700 px-2 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[45px]">
                        <small class="lbl-streak text-[9px] opacity-70">SERƒ∞</small>
                        <span id="b-streak">0</span>
                    </div>
                    <!-- PUAN -->
                    <div class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded-lg font-bold flex flex-col items-center leading-none min-w-[45px]">
                        <small class="lbl-score text-[9px] opacity-70">PUAN</small>
                        <span id="b-score">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- BALON GERƒ∞ Bƒ∞LDƒ∞Rƒ∞M -->
        <div id="b-feedback" class="absolute top-24 left-0 w-full text-center text-4xl font-bold text-white z-30 pointer-events-none opacity-0 transition-opacity" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Harika!</div>
        
        <!-- Balon Alanƒ± -->
        <div id="balloon-container"></div>
    </div>

    <!-- MOLA MODALI -->
    <div id="continue-modal" class="hidden absolute top-0 left-0 w-full h-full bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-sm w-full border-4 border-blue-200">
            <div class="text-6xl mb-4">‚òï</div>
            <h2 id="modal-title" class="text-2xl font-bold text-gray-800 mb-6">20 Soru Tamam!</h2>
            <p id="modal-desc" class="text-gray-500 mb-8">Harika gidiyorsun. Devam etmek ister misin?</p>
            <div class="flex flex-col gap-3">
                <button onclick="resumeGame()" id="btn-continue" class="w-full py-3 bg-green-500 text-white rounded-xl font-bold shadow-[0_4px_0_#15803d] active:shadow-none active:translate-y-[4px] transition-all text-xl">
                    Devam Et
                </button>
                <button onclick="endGame()" id="btn-end" class="w-full py-3 bg-gray-100 text-gray-500 rounded-xl font-bold shadow-[0_4px_0_#d1d5db] active:shadow-none active:translate-y-[4px] transition-all">
                    Bitir
                </button>
            </div>
        </div>
    </div>

    <!-- OYUN Bƒ∞TTƒ∞ MODALI (YENƒ∞) -->
    <div id="gameover-modal" class="hidden absolute top-0 left-0 w-full h-full bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-sm w-full border-4 border-red-200">
            <div class="text-6xl mb-4">ü•∫</div>
            <h2 id="go-title" class="text-3xl font-bold text-red-600 mb-2">Oyun Bitti!</h2>
            <p id="go-score" class="text-2xl font-bold text-gray-700 mb-8">Skorun: 0</p>
            <button onclick="endGame()" id="btn-go-end" class="w-full py-4 bg-blue-500 text-white rounded-xl font-bold shadow-[0_4px_0_#1d4ed8] active:shadow-none active:translate-y-[4px] transition-all text-xl">
                Ana Men√º
            </button>
        </div>
    </div>

    <script>
        // --- √áEVƒ∞Rƒ∞ VE VERƒ∞TABANI ---
        const DB = {
            tr: {
                t: "√áarpƒ±m<br>Canavarƒ±", p: "Adƒ±n ne?", c: "KARAKTERƒ∞Nƒ∞ SE√á", btn: "ƒ∞LERƒ∞",
                sel: "OYUN SE√á",
                g1: "Klasik", g1d: "Soruyu bil, klavyeyle yaz",
                g2: "Balonlar", g2d: "Doƒüru balonu patlat!",
                back: "√áIKI≈û",
                ls: "PUAN", lstr: "SERƒ∞", llv: "CAN",
                pr: ["Harika", "S√ºper", "Doƒüru", "Aferin", "M√ºthi≈ü", "Efsane", "Deha", "≈ûim≈üek", "S√ºpersin"],
                sad: ["√úz√ºlme!", "Tekrar Dene", "Pes Etme", "Seri Bozuldu :(", "Yapabilirsin!", "Az Kaldƒ±!", "Ka√ßƒ±rdƒ±n!", "S√ºre Bitti!"],
                milestone: ["Durdurulamazsƒ±n!", "Efsanevi Seri!", "Matematik Dehasƒ±!", "ƒ∞nanƒ±lmaz!", "Ate≈ü Ediyorsun! üî•"],
                mt: "20 Soru Bitti!", md: "Harika gidiyorsun! Devam mƒ±?", by: "Devam Et", bn: "Bitir",
                got: "Oyun Bitti!", gos: "Skorun:", gob: "Ana Men√º"
            },
            en: {
                t: "Math<br>Monster", p: "Your Name?", c: "CHOOSE CHARACTER", btn: "NEXT",
                sel: "SELECT GAME",
                g1: "Classic", g1d: "Type the answer",
                g2: "Balloons", g2d: "Pop the correct balloon!",
                back: "EXIT",
                ls: "SCORE", lstr: "STREAK", llv: "LIVES",
                pr: ["Great", "Super", "Correct", "Awesome", "Amazing", "Legend", "Genius", "Fast", "Perfect"],
                sad: ["Don't be sad", "Try Again", "Don't Give Up", "Streak Lost :(", "You Can Do It", "So Close!", "Missed!", "Time's Up!"],
                milestone: ["Unstoppable!", "Legendary Streak!", "Math Genius!", "Incredible!", "On Fire! üî•"],
                mt: "20 Questions Done!", md: "You are doing great! Continue?", by: "Continue", bn: "Finish",
                got: "Game Over!", gos: "Score:", gob: "Main Menu"
            }
        };

        let lang = 'tr';
        let pName = '', pChar = 'ü¶Å';
        let currentMode = null;
        let score = 0;
        let streak = 0; 
        let questionCount = 0; 
        let isPaused = false; 
        let lives = 3; 
        let qData = { n1: 1, n2: 1, ans: 1 };
        
        // Klasik Mod Timer Deƒüi≈ükenleri
        let cTimeLeft = 30;
        let cTimerInt;

        const emojis = ["ü¶Å", "üêØ", "üêº", "üê®", "ü¶Ñ", "üöÄ", "ü¶ñ", "ü§ñ", "‚≠ê", "üê±", "üê∂", "üê∏"];
        
        let mistakes = []; 

        function init() {
            renderCharSlider();
            setLang('tr');
        }

        function renderCharSlider() {
            const slider = document.getElementById('char-slider');
            let isDown = false;
            let startX;
            let scrollLeft;
            let isDragging = false; 

            slider.addEventListener('mousedown', (e) => {
                isDown = true;
                isDragging = false;
                slider.style.scrollBehavior = 'auto'; 
                slider.classList.add('active');
                startX = e.pageX;
                scrollLeft = slider.scrollLeft;
            });
            
            const endDrag = () => {
                isDown = false;
                slider.classList.remove('active');
                slider.style.scrollBehavior = 'smooth'; 
            };
            
            slider.addEventListener('mouseleave', endDrag);
            slider.addEventListener('mouseup', endDrag);
            
            slider.addEventListener('mousemove', (e) => {
                if(!isDown) return;
                e.preventDefault();
                const x = e.pageX;
                const walk = (startX - x) * 2; 
                if(Math.abs(walk) > 5) isDragging = true;
                slider.scrollLeft = scrollLeft + walk;
            });

            slider.addEventListener('touchstart', (e) => {
                isDown = true;
                isDragging = false;
                slider.style.scrollBehavior = 'auto'; 
                startX = e.touches[0].pageX;
                scrollLeft = slider.scrollLeft;
            }, {passive: false});

            slider.addEventListener('touchend', () => {
                isDown = false;
                slider.style.scrollBehavior = 'smooth'; 
            });

            slider.addEventListener('touchmove', (e) => {
                if(!isDown) return;
                const x = e.touches[0].pageX;
                const walk = (startX - x) * 2; 
                if(Math.abs(walk) > 5) isDragging = true;
                slider.scrollLeft = scrollLeft + walk;
            }, {passive: false});

            emojis.forEach(e => {
                const d = document.createElement('div');
                d.className = `char-item ${e===pChar?'selected':''}`;
                d.innerText = e;
                d.onclick = (event) => {
                    if(isDragging) return; 
                    pChar = e;
                    document.querySelectorAll('.char-item').forEach(x => x.classList.remove('selected'));
                    d.classList.add('selected');
                    centerEmoji(d);
                };
                slider.appendChild(d);
            });

            setTimeout(() => {
                const sel = slider.querySelector('.selected');
                if(sel) centerEmoji(sel);
            }, 100);
        }

        function centerEmoji(el) {
            const slider = document.getElementById('char-slider');
            const sliderRect = slider.getBoundingClientRect();
            const elRect = el.getBoundingClientRect();
            const offset = (elRect.left + elRect.width / 2) - (sliderRect.left + sliderRect.width / 2);
            slider.scrollTo({
                left: slider.scrollLeft + offset,
                behavior: 'smooth'
            });
        }

        function setLang(l) {
            lang = l;
            const d = DB[l];
            document.getElementById('title-txt').innerHTML = d.t;
            document.getElementById('p-name').placeholder = d.p;
            document.getElementById('lbl-char').innerText = d.c;
            document.getElementById('btn-next').innerText = d.btn;
            document.getElementById('lbl-select-game').innerText = d.sel;
            
            document.getElementById('g1-title').innerText = d.g1; document.getElementById('g1-desc').innerText = d.g1d;
            document.getElementById('g2-title').innerText = d.g2; document.getElementById('g2-desc').innerText = d.g2d;

            document.querySelectorAll('.lbl-score').forEach(el => el.innerText = d.ls);
            document.querySelectorAll('.lbl-streak').forEach(el => el.innerText = d.lstr);
            document.querySelectorAll('.lbl-lives').forEach(el => el.innerText = d.llv); 

            document.getElementById('modal-title').innerText = d.mt;
            document.getElementById('modal-desc').innerText = d.md;
            document.getElementById('btn-continue').innerText = d.by;
            document.getElementById('btn-end').innerText = d.bn;

            // Game Over Textleri
            document.getElementById('go-title').innerText = d.got;
            document.getElementById('btn-go-end').innerText = d.gob;
        }

        function goToMenu() {
            const nm = document.getElementById('p-name');
            if(!nm.value.trim()) { nm.classList.add('shake'); setTimeout(()=>nm.classList.remove('shake'),400); return; }
            pName = nm.value.trim();
            
            document.getElementById('start-view').classList.add('hidden');
            document.getElementById('menu-view').classList.remove('hidden');
            document.getElementById('menu-view').classList.add('flex', 'flex-col');
            
            document.getElementById('player-display').innerText = pName;
            document.getElementById('char-display').innerText = pChar;
        }

        function goBackStart() {
            document.getElementById('menu-view').classList.add('hidden');
            document.getElementById('menu-view').classList.remove('flex');
            document.getElementById('start-view').classList.remove('hidden');
        }

        function startGame(mode) {
            currentMode = mode;
            score = 0;
            streak = 0; 
            questionCount = 0; 
            lives = 3; 
            isPaused = false;
            
            document.getElementById('menu-view').classList.add('hidden');
            document.getElementById('menu-view').classList.remove('flex');

            if(mode === 'classic') initClassic();
            if(mode === 'balloon') initBalloon();
        }

        function endGame() {
            isPaused = false;
            document.getElementById('continue-modal').classList.add('hidden'); 
            document.getElementById('gameover-modal').classList.add('hidden'); // Game Over kapat
            
            if(balloonInterval) clearInterval(balloonInterval);
            if(cTimerInt) clearInterval(cTimerInt); 
            document.getElementById('balloon-container').innerHTML = '';

            document.getElementById('game-classic').classList.add('hidden');
            document.getElementById('game-balloon').classList.add('hidden');

            document.getElementById('menu-view').classList.remove('hidden');
            document.getElementById('menu-view').classList.add('flex');
        }

        function showGameOver() {
            isPaused = true;
            if(cTimerInt) clearInterval(cTimerInt); 
            
            document.getElementById('go-score').innerText = (lang==='tr' ? "Skorun: " : "Score: ") + score;
            document.getElementById('gameover-modal').classList.remove('hidden');
        }

        function checkContinue() {
            questionCount++;
            if(questionCount > 0 && questionCount % 20 === 0) {
                isPaused = true; 
                document.getElementById('continue-modal').classList.remove('hidden');
                return true; 
            }
            return false;
        }

        function resumeGame() {
            isPaused = false;
            document.getElementById('continue-modal').classList.add('hidden');
            
            if(currentMode === 'classic') {
                newClassicQ();
            } else if(currentMode === 'balloon') {
                newBalloonLevel();
            }
        }

        function updateLivesUI() {
            const l1 = document.getElementById('b-lives');
            const l2 = document.getElementById('c-lives');
            if(l1) l1.innerText = lives; 
            if(l2) l2.innerText = lives; 
        }

        function addMistake(n1, n2) {
            const exists = mistakes.some(m => (m.n1 === n1 && m.n2 === n2) || (m.n1 === n2 && m.n2 === n1));
            if(!exists) {
                mistakes.push({n1, n2});
            }
        }

        function removeMistake(n1, n2) {
            mistakes = mistakes.filter(m => !((m.n1 === n1 && m.n2 === n2) || (m.n1 === n2 && m.n2 === n1)));
        }

        function generateQ() {
            if(mistakes.length > 0 && Math.random() < 0.6) {
                const m = mistakes[Math.floor(Math.random() * mistakes.length)];
                qData = { n1: m.n1, n2: m.n2, ans: m.n1 * m.n2 };
                return qData;
            }

            let a = Math.floor(Math.random() * 9) + 1;
            let b = Math.floor(Math.random() * 9) + 1;
            
            if(Math.random() > 0.3) { 
                 a = Math.floor(Math.random() * 5) + 5; 
                 b = Math.floor(Math.random() * 9) + 1; 
                 if(Math.random() > 0.5) b = Math.floor(Math.random() * 5) + 5;
            }
            
            qData = { n1: a, n2: b, ans: a*b };
            return qData;
        }

        function showConfetti() {
            for(let i=0;i<30;i++) parts.push({x:window.innerWidth/2,y:window.innerHeight/2,vx:(Math.random()-.5)*20,vy:(Math.random()-1)*20,c:`hsl(${Math.random()*360},100%,50%)`});
            if(!animating) { animating=true; loopConfetti(); }
        }

        function getPraise() {
            if (streak > 0 && streak % 10 === 0) {
                const milestones = DB[lang].milestone;
                return milestones[Math.floor(Math.random() * milestones.length)] + " " + streak + "!";
            }
            const list = DB[lang].pr;
            const word = list[Math.floor(Math.random() * list.length)];
            return `${word} ${pName} ${pChar}`;
        }

        function getSadMessage(isTimeout = false) {
            if(isTimeout) return lang === 'tr' ? "S√ºre Bitti!" : "Time's Up!";
            const list = DB[lang].sad;
            return list[Math.floor(Math.random() * list.length)] + ` ${pName}`;
        }

        function getMissedMessage() {
            return lang === 'tr' ? "Ka√ßƒ±rdƒ±n!" : "Missed!";
        }

        function showFeedback(elId, type = 'praise') {
            const el = document.getElementById(elId);
            if(!el) return;
            
            if(type === 'sad') {
                el.innerText = getSadMessage();
                el.style.color = '#ef4444'; 
            } else if (type === 'timeout') {
                el.innerText = getSadMessage(true);
                el.style.color = '#f59e0b';
            } else if (type === 'missed') {
                el.innerText = getMissedMessage();
                el.style.color = '#f59e0b'; 
            } else {
                el.innerText = getPraise();
                el.style.color = (streak > 0 && streak % 10 === 0) ? '#a855f7' : '#22c55e'; 
            }

            el.style.opacity = 1;
            el.style.transform = "scale(1.2)";
            el.style.transition = "all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
            
            setTimeout(() => {
                el.style.transform = "scale(1)";
                el.style.opacity = 0;
            }, 1500); 
        }

        function spawnEmoji(isHappy) {
            let list = isHappy ? ['üéâ','‚≠ê', '‚ú®', 'üéà', pChar] : ['üí©','ü•Ä','üåßÔ∏è','‚ùå','ü§î'];
            if(isHappy && streak % 10 === 0) list = ['üèÜ', 'üöÄ', 'üëë', 'üî•', 'üíØ'];

            const count = 5 + Math.floor(Math.random() * 4);
            for(let i=0; i<count; i++) {
                let el = document.createElement('div');
                el.innerText = list[Math.floor(Math.random()*list.length)];
                el.className = 'floating-emoji';
                el.style.left = (10 + Math.random()*80) + '%';
                el.style.top = (40 + Math.random()*30) + '%';
                el.style.animationDelay = (Math.random() * 0.5) + 's';
                document.body.appendChild(el);
                setTimeout(()=>el.remove(), 2000);
            }
        }

        function updateStreakUI() {
            document.getElementById('c-streak').innerText = streak;
            document.getElementById('b-streak').innerText = streak;
        }

        // --- OYUN 1: KLASƒ∞K (G√úNCELLENDƒ∞: Timer ve Can Eklendi) ---
        let cInp = '';
        function initClassic() {
            const el = document.getElementById('game-classic');
            el.classList.remove('hidden');
            el.classList.add('flex', 'flex-col');
            document.getElementById('c-score').innerText = score;
            
            lives = 3;
            updateLivesUI();
            updateStreakUI();
            newClassicQ();
        }

        function newClassicQ() {
            // Timer temizle
            if(cTimerInt) clearInterval(cTimerInt);
            
            generateQ();
            document.getElementById('c-n1').innerText = qData.n1;
            document.getElementById('c-n2').innerText = qData.n2;
            cInp = '';
            updCInp();
            document.getElementById('c-card').style.borderColor = '#60a5fa'; // Blue
            
            // Timer Ba≈ülat
            startClassicTimer();
        }

        function startClassicTimer() {
            cTimeLeft = 30; // 30 Saniye
            document.getElementById('c-timer').innerText = cTimeLeft;
            
            cTimerInt = setInterval(() => {
                if(!isPaused) {
                    cTimeLeft--;
                    document.getElementById('c-timer').innerText = cTimeLeft;
                    if(cTimeLeft <= 0) {
                        clearInterval(cTimerInt);
                        handleClassicWrong(true); // S√ºre bitti
                    }
                }
            }, 1000);
        }

        function cInput(n) { if(cInp.length<3) { cInp+=n; updCInp(); } }
        function cDel() { cInp=cInp.slice(0,-1); updCInp(); }
        function updCInp() {
            const box = document.getElementById('c-ans-box');
            box.innerText = cInp;
            box.style.borderStyle = cInp ? 'solid' : 'dashed';
            box.style.backgroundColor = cInp ? 'white' : '#f3f4f6';
        }

        function handleClassicWrong(isTimeout) {
            streak = 0; 
            updateStreakUI();
            
            addMistake(qData.n1, qData.n2); 

            lives--;
            updateLivesUI();

            const card = document.getElementById('c-card');
            
            if(isTimeout) showFeedback('c-feedback', 'timeout');
            else showFeedback('c-feedback', 'sad'); 
            
            spawnEmoji(false); 
            
            card.classList.add('shake');
            card.style.borderColor = '#ef4444'; // Red
            setTimeout(()=>card.classList.remove('shake'), 400);
            
            cInp=''; updCInp();

            if (lives <= 0) {
                setTimeout(showGameOver, 500); // 0.5sn sonra game over g√∂ster
            } else {
                setTimeout(newClassicQ, 1000); // Yeni soruya ge√ß
            }
        }

        function cCheck() {
            if(!cInp) return;
            const val = parseInt(cInp);
            const card = document.getElementById('c-card');
            
            if(val === qData.ans) {
                clearInterval(cTimerInt); // Timer durdur
                score += 10;
                streak++; 
                document.getElementById('c-score').innerText = score;
                updateStreakUI();
                
                removeMistake(qData.n1, qData.n2); 

                card.style.borderColor = '#22c55e'; // Green
                showFeedback('c-feedback', 'praise'); 
                spawnEmoji(true); 
                showConfetti();
                
                if(checkContinue()) return;

                setTimeout(newClassicQ, 800);
            } else {
                clearInterval(cTimerInt);
                handleClassicWrong(false);
            }
        }

        // --- OYUN 2: BALONLAR ---
        let balloonInterval;
        let balloonSpeed = 2; // Ba≈ülangƒ±√ß hƒ±zƒ±

        function initBalloon() {
            const el = document.getElementById('game-balloon');
            el.classList.remove('hidden');
            el.classList.add('flex', 'flex-col');
            document.getElementById('b-score').innerText = score;
            
            lives = 3; 
            updateLivesUI();
            
            updateStreakUI();
            newBalloonLevel();
            startGameLoop_Balloon();
        }

        function newBalloonLevel() {
            generateQ();
            document.getElementById('b-n1').innerText = qData.n1;
            document.getElementById('b-n2').innerText = qData.n2;
            
            document.getElementById('balloon-container').innerHTML = '';
            
            let answers = [qData.ans];
            while(answers.length < 4) {
                let r = qData.ans + Math.floor(Math.random()*10) - 5;
                if(r > 0 && !answers.includes(r)) answers.push(r);
            }
            answers.sort(() => Math.random() - 0.5);

            let lanes = [10, 32, 54, 76];
            lanes = lanes.map(l => l + (Math.random() * 5 - 2.5));
            lanes.sort(() => Math.random() - 0.5);

            answers.forEach((ans, i) => {
                createBalloon(ans, i * 200, lanes[i]); 
            });
        }

        function createBalloon(val, delay, leftPos) {
            const cont = document.getElementById('balloon-container');
            const b = document.createElement('div');
            b.className = 'balloon';
            
            let finalLeft = (leftPos !== undefined) ? leftPos : (10 + Math.random() * 60);
            b.style.left = finalLeft + '%';
            b.style.top = '-100px';
            b.dataset.val = val;
            
            const colors = ['#fca5a5', '#86efac', '#93c5fd', '#fcd34d', '#d8b4fe'];
            const color = colors[Math.floor(Math.random()*colors.length)];

            b.innerHTML = `
                <div class="balloon-circle" style="background:${color};">${val}</div>
                <div class="balloon-string"></div>
            `;
            
            b.onclick = (e) => checkBalloon(b, val, e);
            
            setTimeout(() => {
                if(!document.getElementById('game-balloon').classList.contains('hidden')) {
                    cont.appendChild(b);
                    animateBalloon(b);
                }
            }, delay);
        }

        function animateBalloon(el) {
            let pos = -100;
            const speed = 1.5 + Math.random(); 
            
            function frame() {
                if(isPaused) {
                    requestAnimationFrame(frame);
                    return;
                }

                if(!el.parentNode && !el.classList.contains('popped')) return; 
                if(el.classList.contains('popped')) return;

                pos += speed;
                el.style.top = pos + 'px';
                
                if(pos > window.innerHeight) {
                    if(document.getElementById('game-balloon').classList.contains('hidden')) return;

                    if(parseInt(el.dataset.val) === qData.ans) {
                        el.remove();
                        handleBalloonMiss();
                    } else {
                        let currentLane = parseFloat(el.style.left); 
                        el.remove();
                        let wrong = qData.ans + Math.floor(Math.random()*10)+1;
                        createBalloon(wrong, 0, currentLane); 
                    }
                } else {
                    requestAnimationFrame(frame);
                }
            }
            requestAnimationFrame(frame);
        }

        function handleBalloonMiss() {
            streak = 0; 
            updateStreakUI();
            addMistake(qData.n1, qData.n2); 
            
            lives--;
            updateLivesUI();

            if (lives <= 0) {
                showGameOver();
                return;
            }
            
            showFeedback('b-feedback', 'missed'); 
            spawnEmoji(false); 
            setTimeout(newBalloonLevel, 500);
        }

        function checkBalloon(el, val, e) {
            if(isPaused) return;

            if(val === qData.ans) {
                score += 10;
                streak++; 
                document.getElementById('b-score').innerText = score;
                updateStreakUI();
                el.classList.add('popped');
                
                removeMistake(qData.n1, qData.n2); 

                const floatScore = document.createElement('div');
                floatScore.className = 'floating-score';
                floatScore.innerText = '+10';
                floatScore.style.left = e.clientX + 'px';
                floatScore.style.top = e.clientY + 'px';
                document.body.appendChild(floatScore);
                setTimeout(()=>floatScore.remove(), 1000);

                showFeedback('b-feedback', 'praise');
                spawnEmoji(true); 
                showConfetti();
                
                if(checkContinue()) return;

                setTimeout(newBalloonLevel, 500);
            } else {
                streak = 0; 
                updateStreakUI();
                addMistake(qData.n1, qData.n2); 

                lives--;
                updateLivesUI();

                showFeedback('b-feedback', 'sad');
                spawnEmoji(false);
                
                el.classList.add('shake');
                setTimeout(()=>el.classList.remove('shake'), 400);
                score = Math.max(0, score - 5);
                document.getElementById('b-score').innerText = score;

                if (lives <= 0) {
                    setTimeout(showGameOver, 500); // 0.5sn sonra game over
                } else {
                    setTimeout(newBalloonLevel, 500); // Yeni soruya ge√ß
                }
            }
        }

        function startGameLoop_Balloon() {
        }

        const cvsC = document.getElementById('confetti');
        const ctxC = cvsC.getContext('2d');
        let parts = [], animating = false;
        
        function resizeConfetti() { cvsC.width=window.innerWidth; cvsC.height=window.innerHeight; }
        window.onresize = () => { resizeConfetti(); };
        resizeConfetti();

        function loopConfetti(){
            ctxC.clearRect(0,0,cvsC.width,cvsC.height);
            parts.forEach((p,i)=>{
                p.x+=p.vx; p.y+=p.vy; p.vy+=0.5;
                ctxC.fillStyle=p.c; ctxC.beginPath(); ctxC.arc(p.x,p.y,5,0,7); ctxC.fill();
                if(p.y>cvsC.height) parts.splice(i,1);
            });
            if(parts.length) requestAnimationFrame(loopConfetti);
            else animating = false;
        }

        init();

    </script>
</body>
</html>
